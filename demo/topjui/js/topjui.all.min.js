/* TopJUI前端框架，使用html调用组件功能的EasyUI极速开发框架 http://www.topjui.com 2017-05-03 */
function getTabWindow(){var a=null;if(topJUI.config.aloneUse)a=window;else{var b=parent.$("#index_tabs").tabs("getSelected");b&&b.find("iframe").length>0&&(a=b.find("iframe")[0].contentWindow)}return a}function showMask(){$('<div class="datagrid-mask"></div>').css({display:"block",width:"100%",height:$(window).height()}).appendTo("body"),$('<div class="datagrid-mask-msg"></div>').html("正在处理，请稍候。。。").appendTo("body").css({display:"block",left:($(document.body).outerWidth(!0)-190)/2,top:($(window).height()-45)/2})}function hideMask(){$(".datagrid-mask").remove(),$(".datagrid-mask-msg").remove()}function addTab(a){var b='<iframe src="'+a.url+'" scrolling="auto" frameborder="0" style="width:100%;height:100%;"></iframe>',c=$("#index_tabs"),d={id:Math.random(),title:a.text,closable:"undefined"==typeof a.closable||a.closable,iconCls:a.iconCls?a.iconCls:"icon-page",content:b,border:a.border||!1,fit:!0};if(c.tabs("exists",d.title))c.tabs("select",d.title);else{var e=$.cookie("menuClickTime"),f=(new Date).getTime();f-e>=1e3?($.cookie("menuClickTime",(new Date).getTime()),c.tabs("myAdd",d)):$.messager.show({title:"温馨提示",msg:"操作过快，请稍后重试！"})}}function bindMenuClickEvent(a,b){if("object"!=typeof b.grid){var c=getOptionsJson(a.closest("div"));b=$.extend(b,c)}var d={};return"openDialog"==b.clickEvent?(d={iconCls:"icon-add",parentGridUnselectedMsg:"请先选中一条主表数据！",dialog:{title:"数据详情",width:700,height:450}},b.dialog.width=b.dialog.width?b.dialog.width:700,b.dialog.height=b.dialog.height?b.dialog.height:"auto",b=$.extend(d,b),"object"==typeof b.dialog&&generateDialogDoc(b)):"openTab"==b.clickEvent?(d={iconCls:"icon-add"},b=$.extend(d,b),a.on("click",function(){addParentTab(b)})):"openWindow"==b.clickEvent?(d={iconCls:"icon-add"},b=$.extend(d,b),a.on("click",function(){openWindow(b)})):"edatagrid"==b.clickEvent?(d={iconCls:"icon-add"},b=$.extend(d,b),a.on("click",function(){"addRow"==b.type&&$("#"+b.grid.id).edatagrid("addRow",0),"saveRow"==b.type&&$("#"+b.grid.id).edatagrid("saveRow"),"cancelRow"==b.type&&$("#"+b.grid.id).edatagrid("cancelRow")})):"doAjax"==b.clickEvent?(d={iconCls:"icon-add"},b=$.extend(d,b),a.on("click",function(){doAjaxHandler(b)})):"request"==b.clickEvent?(d={iconCls:"icon-add"},b=$.extend(d,b),a.on("click",function(){requestHandler(b)})):"delete"==b.clickEvent?(d={iconCls:"icon-delete"},b=$.extend(d,b),a.on("click",function(){deleteHandler(b)})):"filter"==b.clickEvent?(d={iconCls:"icon-filter"},b=$.extend(d,b),a.on("click",function(){filterHandler(b)})):"search"==b.clickEvent?(d={iconCls:"icon-search",href:"/system/search/advanceSearch"},b=$.extend(d,b),a.on("click",function(){searchHandler(b)})):"export"==b.clickEvent?(d={iconCls:"icon-table_go"},b=$.extend(d,b),a.on("click",function(){exportHandler(b)})):"import"==b.clickEvent&&(d={iconCls:"icon-table_go",href:"/system/excel/excelImport"},b=$.extend(d,b),a.on("click",function(){importHandler(b)})),b}function openDialogAndloadDataByParentGrid(a){var b="",c="";"object"==typeof a.parentGrid&&(b=a.parentGrid.unselectedMsg,c=a.parentGrid.params,"datagrid"==a.parentGrid.type||"treegrid"==a.parentGrid.type);var d=getSelectedRowData(a.parentGrid.type,a.parentGrid.id);if(!d)return void $.messager.alert(topJUI.language.message.title.operationTips,a.parentGrid.unselectedMsg||topJUI.language.message.msg.selectParentGrid,topJUI.language.message.icon.warning);if(!a.dialog.beforeOpenCheckUrl||beforeOpenCheck(replaceUrlParamValueByBrace(a.dialog.beforeOpenCheckUrl,d))){var e=$("#"+a.dialog.id);e.iDialog(a);var f=a.dialog.href,g=f;if(a.dialog.href.indexOf("{")!=-1){if(a.dialog.href.indexOf("{parent.")!=-1&&(g=replaceUrlParamValueByBrace(appendSourceUrlParam(f),d,"parent")),g.indexOf("{")!=-1){var h=getSelectedRowData(a.grid.type,a.grid.id);g=replaceUrlParamValueByBrace(appendSourceUrlParam(g),h)}e.dialog({href:g}),e.dialog("open")}else e.dialog("open")}}function openDialogAndloadDataByUrl(a){var b=getSelectedRowData(a.grid.type,a.grid.id);if(!b)return void $.messager.alert(topJUI.language.message.title.operationTips,topJUI.language.message.msg.selectSelfGrid,topJUI.language.message.icon.warning);if(!a.dialog.beforeOpenCheckUrl||beforeOpenCheck(replaceUrlParamValueByBrace(a.dialog.beforeOpenCheckUrl,b))){var c=$("#"+a.dialog.id);c.iDialog(a);var d=a.dialog.href;if(a.dialog.href.indexOf("{")!=-1){var e=replaceUrlParamValueByBrace(appendSourceUrlParam(d),b);c.dialog({href:e}),c.dialog("open")}else c.dialog("open")}}function dialogHandler(a){authCheck(a)&&("loadData"==a.component?editHandler(a):"loadParentData"==a.action?addChildHandler(a):addHandler(a))}function addHandler(a){var b=(getUrl("controller"),{gridId:"datagrid"});a=$.extend(b,a);var c=$("#"+a.dialogId);c.dialog({iconCls:"icon-add",toolbar:"#"+a.dialogId+"-toolbar",buttons:"#"+a.dialogId+"-buttons"}),void 0!=a.dialogHref&&c.dialog("refresh",a.dialogHref),c.dialog("open")}function authCheck(a){if(""==topJUI.config.authUrl)return!0;var b=!1;return $.ajax({type:"post",url:ctx+"/system/authAccess/getAuthByRoleIdAndUrl",data:{url:a},async:!1,success:function(a){if(0==a){var c={title:topJUI.language.message.title.operationTips,msg:topJUI.language.message.msg.permissionDenied,icon:topJUI.language.message.icon.warning};$.messager.alert(c),b=!1}else b=!0}}),b}function beforeOpenCheck(a){var b=!1;return $.ajax({type:"get",url:a,async:!1,success:function(a){if(300==a.statusCode){var c={title:topJUI.language.message.title.operationTips,msg:a.message};$.messager.alert(c),b=!1}else b=!0}}),b}function addChildHandler(a){var b=$("#"+a.parentGridId).treegrid("getSelected")?$("#"+a.parentGridId).treegrid("getSelected"):$("#"+a.parentGridId).datagrid("getSelected");if(b){var c=getUrl("controller"),d={gridId:"datagrid",dialogHref:a.dialogHref?a.dialogHref:c+"edit"};a=$.extend(d,a);var e=$("#"+a.dialogId);e.dialog({iconCls:"icon-add",toolbar:"#"+a.dialogId+"-toolbar",buttons:"#"+a.dialogId+"-buttons"}),void 0!=a.dialogHref&&e.dialog("refresh",a.dialogHref),e.dialog("open"),setTimeout(function(){getTabWindow().$("#"+a.dialogId+" iframe").each(function(a){this.contentWindow.document.body.innerHTML=""});var c={};if(a.gridParam)for(var d=a.gridParam.split(","),f=0;f<d.length;f++)c[d[f]]=b[d[f]];c.puuid=b.uuid,e.form("load",c)},500)}else $.messager.alert(topJUI.language.message.title.operationTips,topJUI.language.message.msg.selectParentGrid,topJUI.language.message.icon.warning)}function editHandler(a){var b=getUrl("controller"),c={gridId:"datagrid",dialogHref:a.dialogHref?a.dialogHref:b+"edit",dialogUrl:a.dialogUrl?a.dialogUrl:b+"getDetailByUuid?uuid={uuid}"};a=$.extend(c,a),loadDialogData(a)}function getCheckedRowsData(a,b){return $("#"+b).treegrid("getChecked")}function getSelectedRowData(a,b){return getRowsDataBySelected(a,b,!1)}function getSelectedRowsData(a,b){return getRowsDataBySelected(a,b,!0)}function getRowsDataBySelected(a,b,c){var d=c?$("#"+b).datagrid("getSelections"):$("#"+b).datagrid("getSelected");return d}function getRowsDataBySelected2(a,b){var c,d;return"object"==typeof a.parentGrid?(d=a.parentGrid.id,"datagrid"==a.parentGrid.type?c=b?$("#"+d).datagrid("getSelections"):$("#"+d).datagrid("getSelected"):"treegrid"==a.parentGrid.type&&(c=b?$("#"+d).treegrid("getSelections"):$("#"+d).treegrid("getSelected"))):"object"==typeof a.grid&&(d=a.grid.id,"datagrid"==a.grid.type?c=b?$("#"+d).datagrid("getSelections"):$("#"+d).datagrid("getSelected"):"treegrid"==a.grid.type&&(c=b?$("#"+d).treegrid("getSelections"):$("#"+d).treegrid("getSelected"))),c}function refreshGrids(a){if("object"==typeof a)for(var b=0;b<a.length;b++){var c=a[b];!function(a){setTimeout(function(){refreshGrid(c.type,c.id,c.clearQueryParams)},100*a)}(b)}}function refreshGrid(a,b,c){"datagrid"==a?(1==c&&$("#"+b).datagrid({queryParams:{clearQueryParams:""}}),$("#"+b).datagrid("reload"),$("#"+b).datagrid("unselectAll")):"treegrid"==a&&($("#"+b).treegrid("reload"),$("#"+b).treegrid("unselectAll"))}function doAjaxHandler(a){var b={gridId:"datagrid",comfirmMsg:"确定要执行该操作吗？",grid:{uncheckedMsg:topJUI.language.message.msg.checkSelfGrid}};if(a=$.extend({},b,a),authCheck(a.url)){if(a.url=appendSourceUrlParam(a.url),a.url.indexOf("{parent")!=-1){var c=getSelectedRowData(a.parentGrid.type,a.parentGrid.id);if(!c)return void $.messager.alert(topJUI.language.message.title.operationTips,topJUI.language.message.msg.selectParentGrid,topJUI.language.message.icon.warning);a.url=replaceUrlParamValueByBrace(a.url,c,"parent")}if("object"==typeof a.grid){var d=$("#"+a.grid.id).datagrid("options");1==a.grid.multiCheck||void 0!=a.grid.uncheckedMsg?$("#"+a.grid.id).datagrid("multiCheckedAjax",a):0==d.singleSelect?$("#"+a.grid.id).datagrid("multiSelectedAjax",a):$("#"+a.grid.id).datagrid("singleSelectedAjax",a)}}}function requestHandler(a){if(authCheck(a.url)){if(a.url=appendSourceUrlParam(a.url),"object"==typeof a.grid){var b=getSelectedRowData(a.grid.type,a.grid.id);if(null==b)return void $.messager.alert(topJUI.language.message.title.operationTips,topJUI.language.message.msg.selectSelfGrid,topJUI.language.message.icon.warning);a.newUrl=replaceUrlParamValueByBrace(a.url,b)}else a.newUrl=a.url;window.location.href=a.newUrl}}function deleteHandler(a){var b=a.url?a.url:getUrl("controller")+"delete";if(authCheck(b)){var c={gridId:"datagrid",url:a.url?appendSourceUrlParam(a.url):getUrl("controller")+"delete"+location.search};a=$.extend(c,a);var d=getCheckedRowsData(a.grid.type,a.grid.id);return 0==d.length?void $.messager.alert(topJUI.language.message.title.operationTips,topJUI.language.message.msg.checkSelfGrid,topJUI.language.message.icon.warning):void $.messager.confirm(topJUI.language.message.title.confirmTips,topJUI.language.message.msg.confirmDelete,function(b){b&&(a.ajaxData={uuid:getMultiRowsFieldValue(d,"uuid"),uuids:getMultiRowsFieldValue(d,"uuid")},doAjax(a)&&refreshGrid(a.grid.type,a.grid.id))})}}function filterHandler(a){var b;"object"==typeof a.grid&&(a.filterOption=[],"datagrid"==a.grid.type?(b=a.grid.id,$(".datagrid-filter-row").length>0?$("#"+b).datagrid("disableFilter"):$("#"+b).datagrid("enableFilter",a.filterOption)):"treegrid"==a.grid.type&&(b=a.grid.id,$(".datagrid-filter-row").length>0?$("#"+b).treegrid("disableFilter"):$("#"+b).treegrid("enableFilter",a.filterOption)))}function searchHandler(a){if("object"==typeof a.grid){getColumnsNameAndField(a.grid.type,a.grid.id);var b=$("#advanceSearchDialog");b.dialog({title:"高级查询",iconCls:"icon-find",toolbar:"#searchHandler-toolbar",buttons:"#searchHandler-buttons",height:250}),b.dialog("open")}}function importHandler(a){if("object"==typeof a.grid){getColumnsNameAndField(a.grid.type,a.grid.id);var b=$("#importExcelDialog");b.dialog({title:"导入Excel数据",iconCls:"icon-find",toolbar:"#importDialog-toolbar",buttons:"#importDialog-buttons"}),b.dialog("open")}}function getColumnsNameAndField(a,b){var c=[],d=[],e=[],f=[];if("datagrid"==a){c=$("#"+b).datagrid("getColumnFields",!0),d=$("#"+b).datagrid("getColumnFields"),e=c.concat(d);for(var g=0;g<e.length;g++){var h=$("#"+b).datagrid("getColumnOption",e[g]);f.push(h.title)}}else if("treegrid"==a){c=$("#"+b).treegrid("getColumnFields",!0),d=$("#"+b).treegrid("getColumnFields"),e=c.concat(d);for(var i=0;i<e.length;i++){var h=$("#"+b).treegrid("getColumnOption",e[i]);f.push(h.title)}}var j=f.join(",").replace("UUID,","").replace(/,操作/g,"").replace(/操作,/g,""),k=e.join(",").replace("UUID,","").replace("uuid,","").replace(/,handle/g,"").replace(/handle,/g,"");$.cookie("gridId",b),$.cookie("gridType",a),$.cookie("colNameStr",j),$.cookie("fieldNameStr",k)}function exportHandler(a){var b=getUrl("controller"),c={gridId:"datagrid",excelTitle:parent.$("#index_tabs").tabs("getSelected").panel("options").title+"_导出数据_"+getCurrentDatetime("YmdHis"),url:a.url?a.url:b+"exportExcel"};if(a=$.extend(c,a),authCheck(a.url)){var d,e,f,g,h,i=[],j=[];if("object"==typeof a.grid)if(d=a.grid.id,"datagrid"==a.grid.type){e=$("#"+d).datagrid("getColumnFields",!0),f=$("#"+d).datagrid("getColumnFields"),g=e.concat(f);for(var k=0;k<g.length;k++)h=$("#"+d).datagrid("getColumnOption",g[k]),i.push(h.title),1==h.hidden||1==h.checkbox?j.push(!0):j.push(!1)}else if("treegrid"==a.grid.type){e=$("#"+d).treegrid("getColumnFields",!0),f=$("#"+d).treegrid("getColumnFields"),g=e.concat(f);for(var l=0;l<g.length;l++)h=$("#"+d).treegrid("getColumnOption",g[l]),i.push(h.title),1==h.hidden||1==h.checkbox?j.push(!0):j.push(!1)}for(var m=0;m<j.length;m++)j[m]&&(i.splice(m,1),g.splice(m,1),j.splice(m,1),m--);var n=i.join(",").replace(/,操作/g,"").replace(/操作,/g,""),o=g.join(",").replace(/,handle/g,"").replace(/handle,/g,"");a.ajaxData={excelTitle:a.excelTitle,colName:n,fieldName:o},window.location.href=a.url+"?excelTitle="+a.excelTitle+"&colName="+n+"&fieldName="+o}}function redoHandler(){$(options.gridId).datagrid("rejectChanges"),$(options.gridId).datagrid("unselectAll")}function doAjax(a){var b=!1,c={};return a=$.extend(c,a),$.ajax({url:a.url,type:"post",data:a.ajaxData,dataType:"json",async:!1,contentType:"application/x-www-form-urlencoded;charset=utf-8",beforeSend:function(){$.messager.progress({text:"正在操作..."})},success:function(c,d,e){$.messager.progress("close"),showMessage(c),refreshGrids(a.reload),b=1==c.statusCode||100==c.statusCode||200==c.statusCode}}),b}function setDialogHrefKeyValue(a,b,c){var d=b.split(","),e=c.split(","),f=$(a).dialog("options").href,g="";for(i=0;i<d.length;i++)f.indexOf("?")>0?f.indexOf(d[i]+"="+e[i])==-1&&(g+="&"+d[i]+"="+e[i]):0==i?g="?"+d[i]+"="+e[i]:g+="&"+d[i]+"="+e[i];$(a).dialog("options").href=f+g}function clearDialogHrefKeyValue(a,b){var c=b.split(","),d=$(a).dialog("options").href;if(d.indexOf("?")>0){var e="",f=d.substring(0,d.indexOf("?")+1),g=d.substring(d.indexOf("?")+1),h=g.split("&");for(i=0;i<h.length;i++)for(j=0;j<c.length;j++)h[i].indexOf(c[j]+"=")>=0&&h.remove(i);1==h.length?e=h[0]:h.length>1&&(e=h.join("&"));var k="";k=f+e;var l=k.substring(k.length-1);"?"==l&&(k=k.substring(0,k.length-1))}else k=d;$(a).dialog("options").href=k}function msgFn(a){var b={},c="";"object"==typeof a?(c=a.code,b={title:a.title,msg:a.message}):(c=a,b=1==a?{title:"温馨提示",msg:"操作成功"}:{title:"温馨提示",msg:"操作失败！未知错误，请重试！"}),!(1!=c&&100!=c&&200!=c||1!=c&&200!=c)?$.messager.show(b):$.messager.alert(b)}function showMessage(a){var b={},c="";"object"==typeof a?(c=a.statusCode,void 0==a.icon&&(a.icon=topJUI.language.message.icon.info),b={showType:topJUI.language.message.showType.slide,title:a.title,msg:a.message,icon:a.icon}):(c=a,b=1==a?{showType:topJUI.language.message.showType.slide,title:topJUI.language.message.title.operationTips,msg:topJUI.language.message.msg.success,icon:topJUI.language.message.icon.info}:{showType:topJUI.language.message.showType.slide,title:topJUI.language.message.title.operationTips,msg:topJUI.language.message.msg.failed,icon:topJUI.language.message.icon.error}),!(1!=c&&100!=c&&200!=c||1!=c&&200!=c)?(b.timeout=1e3,$.messager.show(b)):$.messager.alert(b)}function replaceUrlParamValueByBrace(a,b,c){var d=a;if(a&&a.indexOf("{")>=0){var e=isMultiObj(b)?b[0]:b,f=isNull(c)?"":c+".",g=new RegExp("{"+f+"(.*?)}","g"),h=a.match(g);if(h.length>0)for(var i=0;i<h.length;i++){var j=h[i].replace("{"+f,"").replace("}","");d="multiple"==c?d.replace(h[i],getMultiRowsFieldValue(b,j)):d.replace(h[i],e[j])}}return d}function convertParamValue2Object(a,b,c){var d=a;if(a&&a.indexOf("{")>=0){var e={},f=isMultiObj(b)?b[0]:b,g=isNull(c)?"":c+".",h=new RegExp("{"+g+"(.*?)}","g"),i=a.match(h);if(i.length>0)for(var j=0;j<i.length;j++){var k=i[j].replace("{"+g,"").replace("}","");"multiple"==c?e[k]=d.replace(i[j],getMultiRowsFieldValue(b,k)):e[k]=d.replace(i[j],f[k])}}return e}function convertParamObj2ObjData(a,b){var c,d,e={};for(c in a)d=a[c],isMultiObj(b)?e[c]=getMultiRowsFieldValue(b,d):e[c]="'"+b[d]+"'";return e}function getMultiRowsFieldValue(a,b){for(var c=[],d=0;d<a.length;d++)c.push("'"+a[d][b]+"'");return c.join(",")}function selectAllOptions(a){$(a+" option").attr("selected",!0)}function executeCallBackFun(functionStr,options){if(void 0!=functionStr){for(var handlerBeforeArr=functionStr.split("|"),handlerBeforeParamsArr=handlerBeforeArr[1].split(","),handlerBeforeParams="",h=0;h<handlerBeforeParamsArr.length;h++)handlerBeforeParams+=handlerBeforeParamsArr[h].indexOf("options.")>-1?handlerBeforeParamsArr[h]+",":'"'+handlerBeforeParamsArr[h]+'",';eval(handlerBeforeArr[0]+"("+handlerBeforeParams.substr(0,handlerBeforeParams.length-1)+")")}}function isMultiArr(a){if(!a)return!1;for(var b=0;b<a.length;b++)return a[b]instanceof Array}function isMultiObj(a){if(!a)return!1;for(var b=0;b<a.length;b++)return"object"==typeof a[b]}function bytesToSize(a,b){if(null==b&&(b=2),0===a)return"0 B";var c=1024,d=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],e=Math.floor(Math.log(a)/Math.log(c));return(a/Math.pow(c,e)).toFixed(b)+" "+d[e]}function appendUrlParam(a,b){return a.indexOf("?")==-1?a+"?"+b:a+"&"+b}function appendSourceUrlParam(a){return a.indexOf("?")==-1?a+location.search:a+location.search.replace("?","&")}function getCurrentDatetime(a){var b=new Date;return timestamp2Datetime(b,a)}function timestamp2Datetime(a,b){var c,d=new Date(a),e=d.getFullYear(),f=d.getMonth()+1<10?"0"+(d.getMonth()+1):d.getMonth()+1,g=d.getDate()<10?"0"+d.getDate():d.getDate(),h=d.getHours()<10?"0"+d.getHours():d.getHours(),i=d.getMinutes()<10?"0"+d.getMinutes():d.getMinutes(),j=d.getSeconds()<10?"0"+d.getSeconds():d.getSeconds();return c="YmdHis"==b?e+""+f+g+h+i+j:"Y-m-d H:i:s"==b?e+"-"+f+"-"+g+" "+h+":"+i+":"+j:"Y-m-d"==b?e+"-"+f+"-"+g:e+"-"+f+"-"+g+" "+h+":"+i}function getUrl(a){var b=window.location.pathname;return"controller"==a?url=b.substring(0,b.lastIndexOf("/")+1):url=b,url}function getOptionsJson(a){var b=a.data();return b.options&&(b=0==b.options.indexOf("{")?$.parseJSON(b.options.replace(/'/g,'"')):strToJson("{"+b.options.replace(/'/g,'"')+"}")),b}function setFormElementId(a,b){return void 0==b.id?(b.id=getTimestamp(),a.attr("id",b.id)):a.attr("id",b.id),b}function convertDateToFullDate(a){return(a<10?"0":"")+a}function isNull(a){return""==a||void 0==a||null==a}function getSelectedRowJson(a,b){var c={};if(a)for(var d=a.split(","),e=0;e<d.length;e++)if(d[e].indexOf(":")==-1)c[d[e]]=b[d[e]];else{var f=d[e].split(":");c[f[0]]=b[f[1]]}return c}function strToJson(str){var json=eval("("+str+")");return json}function jsonLength(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c}function getTimestamp(){return(new Date).getTime()}function getRandomNum(a,b){switch(arguments.length){case 1:return parseInt(Math.random()*a+1);case 2:return parseInt(Math.random()*(b-a+1)+a);default:return 0}}!function(a){function b(b){return a(b).data("treegrid")?"treegrid":"datagrid"}function c(b,c){function d(b){var c=0;return a(b).children(":visible").each(function(){c+=a(this)._outerWidth()}),c}var e=!1,f=a(b),g=f.datagrid("getPanel").find("div.datagrid-header"),h=g.find(".datagrid-header-row:not(.datagrid-filter-row)"),i=c?g.find('.datagrid-filter[name="'+c+'"]'):g.find(".datagrid-filter");i.each(function(){var b=a(this).attr("name"),c=f.datagrid("getColumnOption",b),g=a(this).closest("div.datagrid-filter-c"),i=g.find("a.datagrid-filter-btn"),j=h.find('td[field="'+b+'"] .datagrid-cell'),k=j._outerWidth();k!=d(g)&&this.filter.resize(this,k-i._outerWidth()),g.width()>c.boxWidth+c.deltaWidth-1&&(c.boxWidth=g.width()-c.deltaWidth+1,c.width=c.boxWidth+c.deltaWidth,e=!0)}),e&&a(b).datagrid("fixColumnSize")}function d(b,c){var d=a(b).datagrid("getPanel").find("div.datagrid-header");return d.find('tr.datagrid-filter-row td[field="'+c+'"] .datagrid-filter')}function e(c,d){for(var e=b(c),f=a(c)[e]("options").filterRules,g=0;g<f.length;g++)if(f[g].field==d)return g;return-1}function f(c,d){var f=b(c),g=a(c)[f]("options").filterRules,h=e(c,d);return h>=0?g[h]:null}function g(c,f){var g=b(c),i=a(c)[g]("options"),j=i.filterRules;if("nofilter"==f.op)h(c,f.field);else{var k=e(c,f.field);k>=0?a.extend(j[k],f):j.push(f)}var l=d(c,f.field);if(l.length){"nofilter"!=f.op&&l[0].filter.setValue(l,f.value);var m=l[0].menu;if(m){m.find("."+i.filterMenuIconCls).removeClass(i.filterMenuIconCls);var n=m.menu("findItem",i.operators[f.op].text);m.menu("setIcon",{target:n.target,iconCls:i.filterMenuIconCls})}}}function h(c,f){function g(a){for(var b=0;b<a.length;b++){var e=d(c,a[b]);if(e.length){e[0].filter.setValue(e,"");var f=e[0].menu;f&&f.find("."+j.filterMenuIconCls).removeClass(j.filterMenuIconCls)}}}var h=b(c),i=a(c),j=i[h]("options");if(f){var k=e(c,f);k>=0&&j.filterRules.splice(k,1),g([f])}else{j.filterRules=[];var l=i.datagrid("getColumnFields",!0).concat(i.datagrid("getColumnFields"));g(l)}}function i(c){var d=b(c),e=a.data(c,d),f=e.options;f.remoteFilter?a(c)[d]("load"):(a(c)[d]("getPager").pagination("refresh",{pageNumber:1}),a(c)[d]("options").pageNumber=1,a(c)[d]("loadData",e.filterSource||e.data))}function j(b,c,d){var e=a(b).treegrid("options");if(!c||!c.length)return[];var f=[];return a.map(c,function(a){a._parentId=d,f.push(a),f=f.concat(j(b,a.children,a[e.idField]))}),a.map(f,function(a){a.children=void 0}),f}function k(c,d){var e=this,f=b(e),g=a.data(e,f),h=g.options;if("datagrid"==f&&a.isArray(c))c={total:c.length,rows:c};else if("treegrid"==f&&a.isArray(c)){var i=j(e,c,d);c={total:i.length,rows:i}}if(!h.remoteFilter){if(g.filterSource){if(h.isSorting)h.isSorting=void 0;else if("datagrid"==f)g.filterSource=c;else if(g.filterSource.total+=c.length,g.filterSource.rows=g.filterSource.rows.concat(c.rows),d)return h.filterMatcher.call(e,c)}else g.filterSource=c;if(!h.remoteSort&&h.sortName){var k=h.sortName.split(","),l=h.sortOrder.split(","),m=a(e);g.filterSource.rows.sort(function(a,b){for(var c=0,d=0;d<k.length;d++){var e=k[d],f=l[d],g=m.datagrid("getColumnOption",e),h=g.sorter||function(a,b){return a==b?0:a>b?1:-1};if(c=h(a[e],b[e])*("asc"==f?1:-1),0!=c)return c}return c})}if(c=h.filterMatcher.call(e,{total:g.filterSource.total,rows:g.filterSource.rows}),h.pagination){var m=a(e),n=m[f]("getPager");if(n.pagination({onSelectPage:function(a,b){h.pageNumber=a,h.pageSize=b,n.pagination("refresh",{pageNumber:a,pageSize:b}),m[f]("loadData",g.filterSource)},onBeforeRefresh:function(){return m[f]("reload"),!1}}),"datagrid"==f){var o=(h.pageNumber-1)*parseInt(h.pageSize),p=o+parseInt(h.pageSize);c.rows=c.rows.slice(o,p)}else{var q=[],r=[];a.map(c.rows,function(a){a._parentId?r.push(a):q.push(a)}),c.total=q.length;var o=(h.pageNumber-1)*parseInt(h.pageSize),p=o+parseInt(h.pageSize);c.rows=q.slice(o,p).concat(r)}}a.map(c.rows,function(a){a.children=void 0})}return c}function l(d,e){function f(){a("#datagrid-filter-style").length||a("head").append('<style id="datagrid-filter-style">a.datagrid-filter-btn{display:inline-block;width:22px;height:22px;margin:0;vertical-align:top;cursor:pointer;opacity:0.6;filter:alpha(opacity=60);}a:hover.datagrid-filter-btn{opacity:1;filter:alpha(opacity=100);}.datagrid-filter-row .textbox,.datagrid-filter-row .textbox .textbox-text{-moz-border-radius:0;-webkit-border-radius:0;border-radius:0;}.datagrid-filter-row input{margin:0;-moz-border-radius:0;-webkit-border-radius:0;border-radius:0;}.datagrid-filter-cache{position:absolute;width:10px;height:10px;left:-99999px;}</style>')}function h(b){var e=n.dc,f=a(d).datagrid("getColumnFields",b);b&&o.rownumbers&&f.unshift("_");var g=(b?e.header1:e.header2).find("table.datagrid-htable");g.find(".datagrid-filter").each(function(){this.filter.destroy&&this.filter.destroy(this),this.menu&&a(this.menu).menu("destroy")}),g.find("tr.datagrid-filter-row").remove();var h=a('<tr class="datagrid-header-row datagrid-filter-row"></tr>');"bottom"==o.filterPosition?h.appendTo(g.find("tbody")):h.prependTo(g.find("tbody")),o.showFilterBar||h.hide();for(var i=0;i<f.length;i++){var k=f[i],p=a(d).datagrid("getColumnOption",k),q=a("<td></td>").attr("field",k).appendTo(h);if(p&&p.hidden&&q.hide(),"_"!=k&&(!p||!p.checkbox&&!p.expander)){var r=l(k);r?a(d)[m]("destroyFilter",k):r=a.extend({},{field:k,type:o.defaultFilterType,options:o.defaultFilterOptions});var s=o.filterCache[k];if(s)s.appendTo(q);else{s=a('<div class="datagrid-filter-c"></div>').appendTo(q);var t=o.filters[r.type],u=t.init(s,r.options||{});u.addClass("datagrid-filter").attr("name",k),u[0].filter=t,u[0].menu=j(s,r.op),r.options?r.options.onInit&&r.options.onInit.call(u[0],d):o.defaultFilterOptions.onInit.call(u[0],d),o.filterCache[k]=s,c(d,k)}}}}function j(b,c){if(!c)return null;var e=a('<a class="datagrid-filter-btn">&nbsp;</a>').addClass(o.filterBtnIconCls);"right"==o.filterBtnPosition?e.appendTo(b):e.prependTo(b);var f=a("<div></div>").appendTo("body");return a.map(["nofilter"].concat(c),function(b){var c=o.operators[b];c&&a("<div></div>").attr("name",b).html(c.text).appendTo(f)}),f.menu({alignTo:e,onClick:function(b){var c=a(this).menu("options").alignTo,e=c.closest("td[field]"),f=e.attr("field"),h=e.find(".datagrid-filter"),j=h[0].filter.getValue(h);0!=o.onClickMenu.call(d,b,c,f)&&(g(d,{field:f,op:b.name,value:j}),i(d))}}),e[0].menu=f,e.bind("click",{menu:f},function(b){return a(this.menu).menu("show"),!1}),f}function l(a){for(var b=0;b<e.length;b++){var c=e[b];if(c.field==a)return c}return null}e=e||[];var m=b(d),n=a.data(d,m),o=n.options;o.filterRules.length||(o.filterRules=[]),o.filterCache=o.filterCache||{};var p=a.data(d,"datagrid").options,q=p.onResize;p.onResize=function(a,b){c(d),q.call(this,a,b)};var r=p.onBeforeSortColumn;p.onBeforeSortColumn=function(a,b){var c=r.call(this,a,b);return 0!=c&&(o.isSorting=!0),c};var s=o.onResizeColumn;o.onResizeColumn=function(b,e){var f=a(this).datagrid("getPanel").find(".datagrid-header .datagrid-filter-c");f.hide(),a(d).datagrid("fitColumns"),o.fitColumns?c(d):c(d,b),f.show(),s.call(d,b,e)};var t=o.onBeforeLoad;o.onBeforeLoad=function(a,b){a&&(a.filterRules=o.filterStringify(o.filterRules)),b&&(b.filterRules=o.filterStringify(o.filterRules));var c=t.call(this,a,b);if(0!=c)if("datagrid"==m)n.filterSource=null;else if("treegrid"==m&&n.filterSource)if(a){for(var d=a[o.idField],e=n.filterSource.rows||[],f=0;f<e.length;f++)if(d==e[f]._parentId)return!1}else n.filterSource=null;return c},o.loadFilter=function(a,b){var c=o.oldLoadFilter.call(this,a,b);return k.call(this,c,b)},f(),h(!0),h(),o.fitColumns&&setTimeout(function(){c(d)},0),a.map(o.filterRules,function(a){g(d,a)})}var m=a.fn.datagrid.methods.autoSizeColumn,n=a.fn.datagrid.methods.loadData,o=a.fn.datagrid.methods.appendRow,p=a.fn.datagrid.methods.deleteRow;a.extend(a.fn.datagrid.methods,{autoSizeColumn:function(b,d){return b.each(function(){var b=a(this).datagrid("getPanel").find(".datagrid-header .datagrid-filter-c");b.hide(),m.call(a.fn.datagrid.methods,a(this),d),b.show(),c(this,d)})},loadData:function(b,c){return b.each(function(){a.data(this,"datagrid").filterSource=null}),n.call(a.fn.datagrid.methods,b,c)},appendRow:function(b,c){var d=o.call(a.fn.datagrid.methods,b,c);return b.each(function(){var b=a(this).data("datagrid");b.filterSource&&(b.filterSource.total++,b.filterSource.rows!=b.data.rows&&b.filterSource.rows.push(c))}),d},deleteRow:function(b,c){return b.each(function(){var b=a(this).data("datagrid"),d=b.options;if(b.filterSource&&d.idField)if(b.filterSource.rows==b.data.rows)b.filterSource.total--;else for(var e=0;e<b.filterSource.rows.length;e++){var f=b.filterSource.rows[e];if(f[d.idField]==b.data.rows[c][d.idField]){b.filterSource.rows.splice(e,1),b.filterSource.total--;break}}}),p.call(a.fn.datagrid.methods,b,c)}});var q=a.fn.treegrid.methods.loadData,r=a.fn.treegrid.methods.append,s=a.fn.treegrid.methods.insert,t=a.fn.treegrid.methods.remove;a.extend(a.fn.treegrid.methods,{loadData:function(b,c){return b.each(function(){a.data(this,"treegrid").filterSource=null}),q.call(a.fn.treegrid.methods,b,c)},append:function(b,c){return b.each(function(){var b=a(this).data("treegrid"),d=b.options;if(d.oldLoadFilter){var e=j(this,c.data,c.parent);b.filterSource.total+=e.length,b.filterSource.rows=b.filterSource.rows.concat(e),a(this).treegrid("loadData",b.filterSource)}else r(a(this),c)})},insert:function(b,c){return b.each(function(){function b(a){for(var b=d.filterSource.rows,c=0;c<b.length;c++)if(b[c][e.idField]==a)return c;return-1}var d=a(this).data("treegrid"),e=d.options;if(e.oldLoadFilter){var f=(c.before||c.after,b(c.before||c.after)),g=f>=0?d.filterSource.rows[f]._parentId:null,h=j(this,[c.data],g),i=d.filterSource.rows.splice(0,f>=0?c.before?f:f+1:d.filterSource.rows.length);i=i.concat(h),i=i.concat(d.filterSource.rows),d.filterSource.total+=h.length,d.filterSource.rows=i,a(this).treegrid("loadData",d.filterSource)}else s(a(this),c)})},remove:function(b,c){return b.each(function(){var b=a(this).data("treegrid");if(b.filterSource)for(var d=b.options,e=b.filterSource.rows,f=0;f<e.length;f++)if(e[f][d.idField]==c){e.splice(f,1),b.filterSource.total--;break}}),t(b,c)}});var u={filterMenuIconCls:"icon-ok",filterBtnIconCls:"icon-filter",filterBtnPosition:"right",filterPosition:"bottom",remoteFilter:!1,showFilterBar:!0,filterDelay:400,filterRules:[],filterMatchingType:"all",filterMatcher:function(c){function d(a,b){var c=i.filterRules;if(!c.length)return!0;for(var d=0;d<c.length;d++){var e=c[d],f=a[e.field],h=g.datagrid("getColumnOption",e.field);h&&h.formatter&&(f=h.formatter(a[e.field],a,b)),void 0==f&&(f="");var j=i.operators[e.op],k=j.isMatch(f,e.value);if("any"==i.filterMatchingType){if(k)return!0}else if(!k)return!1}return"all"==i.filterMatchingType}function e(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d[i.idField]==b)return d}return null}var f=b(this),g=a(this),h=a.data(this,f),i=h.options;if(i.filterRules.length){var j=[];if("treegrid"==f){var k={};a.map(c.rows,function(a){if(d(a,a[i.idField]))for(k[a[i.idField]]=a,a=e(c.rows,a._parentId);a;)k[a[i.idField]]=a,a=e(c.rows,a._parentId)});for(var l in k)j.push(k[l])}else for(var m=0;m<c.rows.length;m++){var n=c.rows[m];d(n,m)&&j.push(n)}c={total:c.total-(c.rows.length-j.length),rows:j}}return c},defaultFilterType:"text",defaultFilterOperator:"contains",defaultFilterOptions:{onInit:function(c){function d(){var b=a(c)[e]("getFilterRule",g),d=h.val();""!=d?(b&&b.value!=d||!b)&&(a(c)[e]("addFilterRule",{field:g,op:f.defaultFilterOperator,value:d}),a(c)[e]("doFilter")):b&&(a(c)[e]("removeFilterRule",g),a(c)[e]("doFilter"))}var e=b(c),f=a(c)[e]("options"),g=a(this).attr("name"),h=a(this);h.data("textbox")&&(h=h.textbox("textbox")),h.unbind(".filter").bind("keydown.filter",function(b){a(this);this.timer&&clearTimeout(this.timer),13==b.keyCode?d():this.timer=setTimeout(function(){d()},f.filterDelay)})}},filterStringify:function(a){return JSON.stringify(a)},onClickMenu:function(a,b){}};a.extend(a.fn.datagrid.defaults,u),a.extend(a.fn.treegrid.defaults,u),a.fn.datagrid.defaults.filters=a.extend({},a.fn.datagrid.defaults.editors,{label:{init:function(b,c){return a("<span></span>").appendTo(b)},getValue:function(b){return a(b).html()},setValue:function(b,c){a(b).html(c)},resize:function(b,c){a(b)._outerWidth(c)._outerHeight(22)}}}),a.fn.treegrid.defaults.filters=a.fn.datagrid.defaults.filters,a.fn.datagrid.defaults.operators={nofilter:{text:"No Filter"},contains:{text:"Contains",isMatch:function(a,b){return a=String(a),b=String(b),a.toLowerCase().indexOf(b.toLowerCase())>=0}},equal:{text:"Equal",isMatch:function(a,b){return a==b}},notequal:{text:"Not Equal",isMatch:function(a,b){return a!=b}},beginwith:{text:"Begin With",isMatch:function(a,b){return a=String(a),b=String(b),0==a.toLowerCase().indexOf(b.toLowerCase())}},endwith:{text:"End With",isMatch:function(a,b){return a=String(a),b=String(b),a.toLowerCase().indexOf(b.toLowerCase(),a.length-b.length)!==-1}},less:{text:"Less",isMatch:function(a,b){return a<b}},lessorequal:{text:"Less Or Equal",isMatch:function(a,b){return a<=b}},greater:{text:"Greater",isMatch:function(a,b){return a>b}},greaterorequal:{text:"Greater Or Equal",isMatch:function(a,b){return a>=b}}},a.fn.treegrid.defaults.operators=a.fn.datagrid.defaults.operators,a.extend(a.fn.datagrid.methods,{enableFilter:function(c,d){return c.each(function(){var c=b(this),e=a.data(this,c).options;if(e.oldLoadFilter){if(!d)return;a(this)[c]("disableFilter")}e.oldLoadFilter=e.loadFilter,
l(this,d),a(this)[c]("resize"),e.filterRules.length&&(e.remoteFilter?i(this):e.data&&i(this))})},disableFilter:function(c){return c.each(function(){var c=b(this),d=a.data(this,c),e=d.options,f=a(this).data("datagrid").dc,g=f.view.children(".datagrid-filter-cache");g.length||(g=a('<div class="datagrid-filter-cache"></div>').appendTo(f.view));for(var h in e.filterCache)a(e.filterCache[h]).appendTo(g);var i=d.data;d.filterSource&&(i=d.filterSource,a.map(i.rows,function(a){a.children=void 0})),a(this)[c]({data:i,loadFilter:e.oldLoadFilter||void 0,oldLoadFilter:null})})},destroyFilter:function(c,d){return c.each(function(){function c(b){var c=a(g.filterCache[b]),d=c.find(".datagrid-filter");if(d.length){var e=d[0].filter;e.destroy&&e.destroy(d[0])}c.find(".datagrid-filter-btn").each(function(){a(this.menu).menu("destroy")}),c.remove(),g.filterCache[b]=void 0}var e=b(this),f=a.data(this,e),g=f.options;if(d)c(d);else{for(var h in g.filterCache)c(h);a(this).datagrid("getPanel").find(".datagrid-header .datagrid-filter-row").remove(),a(this).data("datagrid").dc.view.children(".datagrid-filter-cache").remove(),g.filterCache={},a(this)[e]("resize"),a(this)[e]("disableFilter")}})},getFilterRule:function(a,b){return f(a[0],b)},addFilterRule:function(a,b){return a.each(function(){g(this,b)})},removeFilterRule:function(a,b){return a.each(function(){h(this,b)})},doFilter:function(a){return a.each(function(){i(this)})},getFilterComponent:function(a,b){return d(a[0],b)},resizeFilter:function(a,b){return a.each(function(){c(this,b)})}})}(jQuery),function(a){function b(){h=a.grep(h,function(a){return a.length&&a.data("edatagrid")})}function c(c){b(),a.map(h,function(b){b[0]!=a(c)[0]&&b.edatagrid("saveRow")}),b()}function d(c){b();for(var d=0;d<h.length;d++)if(a(h[d])[0]==a(c)[0])return;h.push(a(c))}function e(c){b(),h=a.grep(h,function(b){return a(b)[0]!=a(c)[0]})}function f(b){var c=a.data(b,"edatagrid").options;a(b).datagrid(a.extend({},c,{onDblClickCell:function(d,e,f){c.editing&&(a(this).edatagrid("editRow",d),g(b,e)),c.onDblClickCell&&c.onDblClickCell.call(b,d,e,f)},onClickCell:function(d,e,f){c.editing&&c.editIndex>=0&&(a(this).edatagrid("editRow",d),g(b,e)),c.onClickCell&&c.onClickCell.call(b,d,e,f)},onBeforeEdit:function(e,f){return(!c.onBeforeEdit||0!=c.onBeforeEdit.call(b,e,f))&&(c.autoSave&&d(this),void(c.originalRow=a.extend(!0,[],f)))},onAfterEdit:function(d,f){e(this),c.editIndex=-1;var g=f.isNewRecord?c.saveUrl:c.updateUrl;if(g){for(var h=!1,i=a(this).edatagrid("getColumnFields",!0).concat(a(this).edatagrid("getColumnFields")),j=0;j<i.length;j++){var k=i[j],l=a(this).edatagrid("getColumnOption",k);if(l.editor&&c.originalRow[k]!=f[k]){h=!0;break}}h?a.post(g,f,function(e){if(e.isError)return a(b).edatagrid("cancelRow",d),a(b).edatagrid("selectRow",d),a(b).edatagrid("editRow",d),void c.onError.call(b,d,e);if(e.isNewRecord=null,a(b).datagrid("updateRow",{index:d,row:e}),c.tree){var g=f[c.idField||"id"],h=a(c.tree),i=h.tree("find",g);if(i)i.text=f[c.treeTextField],h.tree("update",i);else{var j=h.tree("find",f[c.treeParentField]);h.tree("append",{parent:j?j.target:null,data:[{id:g,text:f[c.treeTextField]}]})}}c.onSuccess.call(b,d,f),c.onSave.call(b,d,f)},"json"):c.onSave.call(b,d,f)}else c.onSave.call(b,d,f);c.onAfterEdit&&c.onAfterEdit.call(b,d,f)},onCancelEdit:function(d,f){e(this),c.editIndex=-1,f.isNewRecord&&a(this).datagrid("deleteRow",d),c.onCancelEdit&&c.onCancelEdit.call(b,d,f)},onBeforeLoad:function(d){if(0==c.onBeforeLoad.call(b,d))return!1;if(a(this).edatagrid("cancelRow"),c.tree){var e=a(c.tree).tree("getSelected");d[c.treeParentField]=e?e.id:void 0}}})),c.tree&&a(c.tree).tree({url:c.treeUrl,onClick:function(c){a(b).datagrid("load")},onDrop:function(d,e,f){var g=a(this).tree("getNode",d).id;a.ajax({url:c.treeDndUrl,type:"post",data:{id:e.id,targetId:g,point:f},dataType:"json",success:function(){a(b).datagrid("load")}})}})}function g(b,c){var d,e=a(b).edatagrid("options"),f=a(b).datagrid("getEditor",{index:e.editIndex,field:c});if(f)d=f.target;else{var g=a(b).datagrid("getEditors",e.editIndex);g.length&&(d=g[0].target)}d&&(a(d).hasClass("textbox-f")?a(d).textbox("textbox").focus():a(d).focus())}var h=[];a(function(){a(document).unbind(".edatagrid").bind("mousedown.edatagrid",function(b){var d=a(b.target).closest("div.datagrid-view,div.combo-panel,div.window,div.window-mask");return d.length?void(d.hasClass("datagrid-view")&&c(d.children("table"))):void c()})}),a.fn.edatagrid=function(b,c){if("string"==typeof b){var d=a.fn.edatagrid.methods[b];return d?d(this,c):this.datagrid(b,c)}return b=b||{},this.each(function(){var c=a.data(this,"edatagrid");c?a.extend(c.options,b):a.data(this,"edatagrid",{options:a.extend({},a.fn.edatagrid.defaults,a.fn.edatagrid.parseOptions(this),b)}),f(this)})},a.fn.edatagrid.parseOptions=function(b){return a.extend({},a.fn.datagrid.parseOptions(b),{})},a.fn.edatagrid.methods={options:function(b){var c=a.data(b[0],"edatagrid").options;return c},loadData:function(b,c){return b.each(function(){a(this).edatagrid("cancelRow"),a(this).datagrid("loadData",c)})},enableEditing:function(b){return b.each(function(){var b=a.data(this,"edatagrid").options;b.editing=!0})},disableEditing:function(b){return b.each(function(){var b=a.data(this,"edatagrid").options;b.editing=!1})},isEditing:function(b,c){var d=a.data(b[0],"edatagrid").options,e=d.finder.getTr(b[0],c);return e.length&&e.hasClass("datagrid-row-editing")},editRow:function(b,c){return b.each(function(){var b=a(this),d=a.data(this,"edatagrid").options,e=d.editIndex;if(e!=c)if(b.datagrid("validateRow",e)){if(e>=0&&0==d.onBeforeSave.call(this,e))return void setTimeout(function(){b.datagrid("selectRow",e)},0);if(b.datagrid("endEdit",e),b.datagrid("beginEdit",c),!b.edatagrid("isEditing",c))return;d.editIndex=c,g(this);var f=b.datagrid("getRows");d.onEdit.call(this,c,f[c])}else setTimeout(function(){b.datagrid("selectRow",e)},0)})},addRow:function(b,c){return b.each(function(){function b(a,b){void 0==a?(d.datagrid("appendRow",b),e.editIndex=f.length-1):(d.datagrid("insertRow",{index:a,row:b}),e.editIndex=a)}var d=a(this),e=a.data(this,"edatagrid").options;if(e.editIndex>=0){if(!d.datagrid("validateRow",e.editIndex))return void d.datagrid("selectRow",e.editIndex);if(0==e.onBeforeSave.call(this,e.editIndex))return void setTimeout(function(){d.datagrid("selectRow",e.editIndex)},0);d.datagrid("endEdit",e.editIndex)}var f=d.datagrid("getRows");if("object"==typeof c?b(c.index,a.extend(c.row,{isNewRecord:!0})):b(c,{isNewRecord:!0}),d.datagrid("beginEdit",e.editIndex),d.datagrid("selectRow",e.editIndex),e.tree){var g=a(e.tree).tree("getSelected");f[e.editIndex][e.treeParentField]=g?g.id:0}e.onAdd.call(this,e.editIndex,f[e.editIndex])})},saveRow:function(b){return b.each(function(){var b=a(this),c=a.data(this,"edatagrid").options;if(c.editIndex>=0){if(0==c.onBeforeSave.call(this,c.editIndex))return void setTimeout(function(){b.datagrid("selectRow",c.editIndex)},0);a(this).datagrid("endEdit",c.editIndex)}})},cancelRow:function(b){return b.each(function(){var b=a.data(this,"edatagrid").options;b.editIndex>=0&&a(this).datagrid("cancelEdit",b.editIndex)})},destroyRow:function(b,c){return b.each(function(){function b(b){var c=d.datagrid("getRowIndex",b);if(c!=-1)if(b.isNewRecord)d.datagrid("cancelEdit",c);else if(e.destroyUrl){var f=b[e.idField||"id"];a.post(e.destroyUrl,{id:f},function(c){var g=d.datagrid("getRowIndex",f);if(c.isError)return d.datagrid("selectRow",g),void e.onError.call(d[0],g,c);if(e.tree){d.datagrid("reload");var h=a(e.tree),i=h.tree("find",f);i&&h.tree("remove",i.target)}else d.datagrid("cancelEdit",g),d.datagrid("deleteRow",g);e.onDestroy.call(d[0],g,b);var j=d.datagrid("getPager");j.length&&!d.datagrid("getRows").length&&(d.datagrid("options").pageNumber=j.pagination("options").pageNumber,d.datagrid("reload"))},"json")}else d.datagrid("cancelEdit",c),d.datagrid("deleteRow",c),e.onDestroy.call(d[0],c,b)}var d=a(this),e=a.data(this,"edatagrid").options,f=[];if(void 0==c)f=d.datagrid("getSelections");else for(var g=a.isArray(c)?c:[c],h=0;h<g.length;h++){var i=e.finder.getRow(this,g[h]);i&&f.push(i)}return f.length?void a.messager.confirm(e.destroyMsg.confirm.title,e.destroyMsg.confirm.msg,function(a){if(a){for(var c=0;c<f.length;c++)b(f[c]);d.datagrid("clearSelections")}}):void a.messager.show({title:e.destroyMsg.norecord.title,msg:e.destroyMsg.norecord.msg})})}},a.fn.edatagrid.defaults=a.extend({},a.fn.datagrid.defaults,{singleSelect:!0,editing:!0,editIndex:-1,destroyMsg:{norecord:{title:"Warning",msg:"No record is selected."},confirm:{title:"Confirm",msg:"Are you sure you want to delete?"}},autoSave:!1,url:null,saveUrl:null,updateUrl:null,destroyUrl:null,tree:null,treeUrl:null,treeDndUrl:null,treeTextField:"name",treeParentField:"parentId",onAdd:function(a,b){},onEdit:function(a,b){},onBeforeSave:function(a){},onSave:function(a,b){},onSuccess:function(a,b){},onDestroy:function(a,b){},onError:function(a,b){}}),a.parser.plugins.push("edatagrid")}(jQuery),function(a){a.fn.iCombotree=function(b){function c(b,c){var d=b.tree("getSelected"),e={id:a(c.combotreeId).combotree("getValue")};if(void 0==d&&""!=e.id){var f;a.ajax({type:"POST",url:replaceUrlParamValueByBrace(c.getFatherIdsUrl,e),success:function(b){var d=b.split(",");for(i=d.length-1;i>=0;i--)f=a(c.combotreeId).combotree("tree").tree("find",d[i].replace(/'/g,"")),f&&a(c.combotreeId).combotree("tree").tree("expand",f.target)}}),void 0!=e.id&&a(c.combotreeId).combotree("setValue",e.id)}}var d={combotreeId:this.selector,url:ctx+"/system/codeItem/getListByCodeSetIdAndLevelId?codeSetId={codeSetId}&levelId={levelId}",expandUrl:ctx+"/system/codeItem/getListByPid?pid={pid}",getFatherIdsUrl:"",width:153,height:30,panelHeight:"auto",required:!1,lines:!1,multiple:!1,checkbox:!0,onlyLeafCheck:!1,editable:!1,readonly:!1,animate:!0,expandAll:!1,onBeforeSelect:function(c){if(b.onlyLeafCheck){var d=a(this).tree("isLeaf",c.target);if(!d)return a.messager.alert("提示操作！","请展开选择子节点！","warning"),!1}}},b=a.extend(d,b);b.url.indexOf("codeSetId")==-1?b.url.indexOf("?")==-1?b.url=b.url+"?codeSetId="+b.codeSetId+"&levelId="+b.levelId:b.url=b.url+"&codeSetId="+b.codeSetId+"&levelId="+b.levelId:b.url=b.url.replace("{codeSetId}",b.codeSetId).replace("{levelId}",b.levelId),""==b.combotreeId&&(b.combotreeId=a(this).context);var e=a(this);e.combotree({url:b.url,width:b.width,height:b.height,panelHeight:b.panelHeight,required:b.required,lines:b.lines,multiple:b.multiple,checkbox:b.checkbox,onlyLeafCheck:b.onlyLeafCheck,editable:b.editable,readonly:b.readonly,animate:b.animate,onBeforeExpand:function(c,d){a(this).tree("options").url=replaceUrlParamValueByBrace(b.expandUrl,c)},onBeforeSelect:b.onBeforeSelect,onLoadSuccess:function(d,e){var f=a("#"+b.id).combotree("tree");f.tree("expand",f.tree("getRoot").target),b.expandAll&&f.tree("expandAll"),b.getFatherIdsUrl&&setTimeout(function(){c(f,b)},100)},onSelect:function(c){var d=a("#"+b.id).closest("form");if(b.params){var e=getSelectedRowJson(b.params,c);getTabWindow().$("#"+d.attr("id")).form("load",e)}"object"==typeof b.backfill&&a.getJSON(replaceUrlParamValueByBrace(b.backfill.url,c),{},function(a){getTabWindow().$("#"+d.attr("id")).form("load",a)})},onShowPanel:function(){},onChange:b.onChange})}}(jQuery),addParentTab=function(a){var b,c;if("object"==typeof a.grid){if(1==a.grid.checkboxSelect){var d=getCheckedRowsData(a.grid.type,a.grid.id);if(0==d.length)return void $.messager.alert(topJUI.language.message.title.operationTips,topJUI.language.message.msg.checkSelfGrid,topJUI.language.message.icon.warning);b=d[0].UUID?a.tab.href.indexOf("?")>=0?a.tab.href+"&UUID="+getMultiRowsFieldValue(d,"UUID"):a.tab.href+"?UUID="+getMultiRowsFieldValue(d,"UUID"):a.tab.href.indexOf("?")>=0?a.tab.href+"&uuid="+getMultiRowsFieldValue(d,"uuid"):a.tab.href+"?uuid="+getMultiRowsFieldValue(d,"uuid")}else{var e=getSelectedRowData(a.grid.type,a.grid.id);if(!e)return void $.messager.alert(topJUI.language.message.title.operationTips,topJUI.language.message.msg.selectSelfGrid,topJUI.language.message.icon.warning);b=replaceUrlParamValueByBrace(a.tab.href,e)}c=a.tab.title}else b=a.href,c=a.title;var f='<iframe src="'+b+'" frameborder="0" style="border:0;width:100%;height:100%;"></iframe>';parent.$("#index_tabs").tabs("add",{title:c,content:f,closable:!0,iconCls:"icon-page"})},openWindow=function(a){var b;if("object"==typeof a.grid)if(1==a.grid.checkboxSelect){var c=getCheckedRowsData(a.grid.type,a.grid.id);if(0==c.length)return void $.messager.alert(topJUI.language.message.title.operationTips,topJUI.language.message.msg.checkSelfGrid,topJUI.language.message.icon.warning)}else{var d=getSelectedRowData(a.grid.type,a.grid.id);if(!d)return void $.messager.alert(topJUI.language.message.title.operationTips,topJUI.language.message.msg.selectSelfGrid,topJUI.language.message.icon.warning);b=replaceUrlParamValueByBrace(a.href,d)}else b=a.href;window.open(b)},$.fn.serializeObject=function(){var a={},b=this.serializeArray();return $.each(b,function(){void 0!==a[this.name]?(a[this.name].push||(a[this.name]=[a[this.name]]),a[this.name].push(this.value||"")):a[this.name]=this.value||""}),a};var defaultConfig={pageLoadComplete:!1,config:{ctx:"",mainPagePath:"/system/index/index",pkName:"uuid"},language:{message:{showType:{slide:"slide",fade:"fade",show:"show"},title:{operationTips:"操作提示",confirmTips:"确认提示"},msg:{success:"操作成功",failed:"操作失败",error:"未知错误",checkSelfGrid:"请先勾选要操作的数据前的复选框",selectSelfGrid:"请先选中要操作的数据",selectParentGrid:"请先选中主表中要操作的一条数据",permissionDenied:"对不起，你没有操作权限",confirmDelete:"你确定要删除所选的数据吗？"},icon:{error:"error",question:"question",info:"info",warning:"warning"}}},eventType:{initUI:{base:"topjui.initUI.base",dialog:"topjui.initUI.dialog",base2:"topjui.initUI.base2",echarts:"topjui.initUI.echarts",form:"topjui.initUI.form",advanceSearchForm:"topjui.initUI.advanceSearchForm",importExcelForm:"topjui.initUI.importExcelForm"},beforeInitUI:"topjui.beforeInitUI",afterInitUI:"topjui.afterInitUI",ajaxStatus:"topjui.ajaxStatus",resizeGrid:"topjui.resizeGrid",beforeAjaxLoad:"topjui.beforeAjaxLoad",beforeLoadNavtab:"topjui.beforeLoadNavtab",beforeLoadDialog:"topjui.beforeLoadDialog",afterLoadNavtab:"topjui.afterLoadNavtab",afterLoadDialog:"topjui.afterLoadDialog",beforeCloseNavtab:"topjui.beforeCloseNavtab",beforeCloseDialog:"topjui.beforeCloseDialog",afterCloseNavtab:"topjui.afterCloseNavtab",afterCloseDialog:"topjui.afterCloseDialog"}};topJUI=$.extend(!0,defaultConfig,topJUI),function(a){a.fn.iDatagrid=function(b){var c={datagridId:this.selector,width:"100%",height:"100%",autoRowHeight:!1,nowrap:!0,fit:!0,fitColumns:!1,border:!1,striped:!0,singleSelect:!0,url:"",toolbar:this.selector+"-toolbar",columns:[[{field:"uuid",title:"UUID",align:"center"},{field:"title",title:"标题",align:"left"},{field:"creator",title:"发布人",align:"center"},{field:"createTime",title:"发布时间",align:"center"}]],multiSort:!1,sortName:"",sortOrder:"",addButton:!0,editButton:!0,deleteButton:!0,searchButton:!0,addDialogTitle:"新增",editDialogTitle:"编辑",rownumbers:!0,pagination:!0,pageNumber:1,pageSize:20,pageList:[20,30,40,50,100,200],editable:!0,queryFormId:"",queryAction:"",infoFormId:"",infoAddAction:"",infoUpdateAction:"",infoDlgDivId:"",deleteAction:"",deleteMsg:"",moveDlgDivId:"",moveFormId:"",moveTreeId:"",queryParams:{},queryParamsVCN:{},checkOnSelect:!1,selectOnCheck:!1,kindEditor:[],addDialogId:"#editDialog",editDialogId:"#editDialog",gridParam:"uuid"},b=a.extend(c,b),d=getUrl("controller");b.url=b.url?b.url:d+"getPageSetData",b.getDetailUrl=b.getDetailUrl?b.getDetailUrl:d+"getDetailByUuid",b.addDialogHref=b.addDialogHref?b.addDialogHref:d+"add",b.saveUrl=b.saveUrl?b.saveUrl:d+"save",b.editDialogHref=b.editDialogHref?b.editDialogHref:d+"edit",b.updateUrl=b.updateUrl?b.updateUrl:d+"update",b.deleteUrl=b.deleteUrl?b.deleteUrl:d+"delete",a(this).datagrid({filterBtnIconCls:"icon-filter",remoteFilter:!0,width:b.width,height:b.height,autoRowHeight:b.autoRowHeight,nowrap:b.nowrap,striped:b.striped,singleSelect:b.singleSelect,url:appendSourceUrlParam(b.url),toolbar:b.toolbar,loadMsg:b.loadMsg,rownumbers:b.rownumbers,pagination:b.pagination,paginPosition:"bottom",pageNumber:b.pageNumber,pageSize:b.pageSize,pageList:b.pageList,frozenColumns:b.frozenColumns,columns:b.columns,multiSort:b.multiSort,sortName:b.sortName,sortOrder:b.sortOrder,fit:b.fit,fitColumns:b.fitColumns,border:b.border,checkOnSelect:b.checkOnSelect,selectOnCheck:b.selectOnCheck,onBeforeLoad:function(a){},onLoadSuccess:function(){if(a("#"+b.id).datagrid("doCellTip",{cls:{},delay:500}),"object"==typeof b.childGrid)for(var c=b.childGrid.grids,d=0;d<c.length;d++){var e=c[d].syncReload;if(e){var f=a("#"+c[d].id);"datagrid"==c[d].type?f.datagrid("load"):"treegrid"==c[d].type&&f.treegrid("load")}}},onClickRow:function(c,d){if("object"==typeof b.childGrid){var e={};e=getSelectedRowJson(b.childGrid.params,d);for(var f=b.childGrid.grids,g=0;g<f.length;g++)!function(b){setTimeout(function(){var c=a("#"+f[b].id);if("datagrid"==f[b].type){var d=c.datagrid("options").queryParams;c.datagrid("options").queryParams=a.extend({},d,e),c.datagrid("load")}else if("treegrid"==f[b].type){var d=c.treegrid("options").queryParams;c.treegrid("options").queryParams=a.extend({},d,e),c.treegrid("load")}else if("panel"==f[b].type){var g=replaceUrlParamValueByBrace(f[b].href,e);c.panel("refresh",g)}},100*b)}(g)}if("object"==typeof b.childTab)for(var h=b.childTab.tabs,g=0;g<h.length;g++){var i=a("#"+h[g].id),j=i.tabs("options"),k=i.tabs("getTabIndex",i.tabs("getSelected")),l=j.tabs,m=a("#"+l[k].id),e={};if(e=getSelectedRowJson(h[g].params,d),"datagrid"==l[k].type){var n=m.datagrid("options").queryParams;m.datagrid("options").queryParams=a.extend({},n,e),m.datagrid("load")}else if("treegrid"==l[k].type){var n=m.treegrid("options").queryParams;m.treegrid("options").queryParams=a.extend({},n,e),m.treegrid("load")}else if("panel"==l[k].type){var o=m.panel("options"),p=replaceUrlParamValueByBrace(o.dynamicHref,d),q='<iframe src="'+p+'" scrolling="auto" frameborder="0" style="width:100%;height:100%;"></iframe>';m.panel({content:q})}}}})};var b=function(b,c){b.preventDefault();var d=a(this),e=this.headerContextMenu,f="tree-checkbox1",g="tree-checkbox0";if(!e){for(var h=a('<div style="width:150px;"></div>').appendTo("body"),i=d.datagrid("getColumnFields"),j=0;j<i.length;j++){var k=d.datagrid("getColumnOption",i[j]);k.hidden?a('<div iconCls="'+g+'" field="'+i[j]+'"/>').html(k.title).appendTo(h):a('<div iconCls="'+f+'" field="'+i[j]+'"/>').html(k.title).appendTo(h)}e=this.headerContextMenu=h.menu({onClick:function(b){var c=a(b.target).attr("field");b.iconCls==f?(d.datagrid("hideColumn",c),a(this).menu("setIcon",{target:b.target,iconCls:g})):(d.datagrid("showColumn",c),a(this).menu("setIcon",{target:b.target,iconCls:f})),e.menu("show")}})}e.menu("show",{left:b.pageX,top:b.pageY})};a.fn.datagrid.defaults.onHeaderContextMenu=b,a.fn.treegrid.defaults.onHeaderContextMenu=b,a.extend(a.fn.datagrid.methods,{singleSelectedAjax:function(b,c){var d=getSelectedRowData(c.grid.type,c.grid.id);return null==d?void a.messager.alert(topJUI.language.message.title.operationTips,topJUI.language.message.msg.selectSelfGrid,topJUI.language.message.icon.warning):(c.url=replaceUrlParamValueByBrace(c.url,d),void a.messager.confirm(topJUI.language.message.title.confirmTips,c.comfirmMsg,function(a){a&&doAjax(c)&&refreshGrid(c.grid.type,c.grid.id)}))},multiSelectedAjax:function(b,c){var d=getSelectedRowsData(c.grid.type,c.grid.id);return 0==d.length?void a.messager.alert(topJUI.language.message.title.operationTips,topJUI.language.message.msg.selectSelfGrid,topJUI.language.message.icon.warning):void a.messager.confirm(topJUI.language.message.title.confirmTips,c.comfirmMsg,function(a){void 0==c.grid.params&&(c.grid.params={uuid:topJUI.config.pkName}),c.ajaxData=convertParamObj2ObjData(c.grid.params,d),a&&doAjax(c)&&refreshGrid(c.grid.type,c.grid.id)})},multiCheckedAjax:function(b,c){var d=getCheckedRowsData(c.grid.type,c.grid.id);return 0==d.length?void a.messager.alert(topJUI.language.message.title.operationTips,c.grid.uncheckedMsg,topJUI.language.message.icon.warning):void a.messager.confirm(topJUI.language.message.title.confirmTips,c.comfirmMsg,function(a){void 0==c.grid.params&&(c.grid.params={uuid:topJUI.config.pkName}),c.ajaxData=convertParamObj2ObjData(c.grid.params,d),a&&doAjax(c)&&refreshGrid(c.grid.type,c.grid.id)})},doCellTip:function(b,c){function d(b,c,d){""!=a(c).text()&&b.tooltip.text(a(c).text()).css({top:d.pageY+10+"px",left:d.pageX+20+"px","z-index":a.fn.window.defaults.zIndex,display:"block"})}return b.each(function(){var b=a(this),e=a(this).data("datagrid");if(!e.tooltip){var f=b.datagrid("getPanel").panel("panel"),g={border:"1px solid #333",padding:"1px",color:"#333",background:"#f7f5d1",position:"absolute","max-width":"400px","border-radius":"4px","-moz-border-radius":"4px","-webkit-border-radius":"4px",display:"none"},h=a("<div id='celltip'></div>").appendTo("body");h.css(a.extend({},g,c.cls)),e.tooltip=h,f.find(".datagrid-body").each(function(){var b=a(this).find("> div.datagrid-body-inner").length?a(this).find("> div.datagrid-body-inner")[0]:this;a(b).undelegate("td","mouseover").undelegate("td","mouseout").undelegate("td","mousemove").delegate("td",{mouseover:function(a){if(c.delay){e.tipDelayTime&&clearTimeout(e.tipDelayTime);var b=this;e.tipDelayTime=setTimeout(function(){d(e,b,a)},c.delay)}else d(e,this,a)},mouseout:function(a){e.tipDelayTime&&clearTimeout(e.tipDelayTime),e.tooltip.css({display:"none"})},mousemove:function(a){var b=this;e.tipDelayTime?(clearTimeout(e.tipDelayTime),e.tipDelayTime=setTimeout(function(){d(e,b,a)},c.delay)):d(e,b,a)}})})}})},cancelCellTip:function(b){return b.each(function(){var b=a(this).data("datagrid");if(b.tooltip){b.tooltip.remove(),b.tooltip=null;var c=a(this).datagrid("getPanel").panel("panel");c.find(".datagrid-body").undelegate("td","mouseover").undelegate("td","mouseout").undelegate("td","mousemove")}b.tipDelayTime&&(clearTimeout(b.tipDelayTime),b.tipDelayTime=null)})}})}(jQuery),function(a){a.fn.iDialog=function(b){var c=b.dialog,d=a("#"+c.id),e={currentDialogId:this.selector,width:700,height:"auto",title:"编辑",modal:!0,closed:!0,iconCls:"icon-save",collapsible:!0,maximizable:!0,minimizable:!1,maximized:!1,resizable:!0,openAnimation:"show",openDuration:100,closeAnimation:"show",closeDuration:400,zIndex:10,toolbar:this.selector+"-toolbar",buttons:this.selector+"-buttons",postfix:"Edit",combotreeFields:"",refreshTreeId:"",onBeforeOpen:function(){},onLoad:function(){if(a(this).trigger(topJUI.eventType.initUI.form),a(this).dialog("center"),void 0!=c.url){var e=getSelectedRowData(b.grid.type,b.grid.id),f=replaceUrlParamValueByBrace(c.url,e);a.getJSON(f,function(a){if(d.form("load",a),"string"==typeof c.editor||"object"==typeof c.editor){if("string"==typeof c.editor){var b=[],e=[];b=c.editor.replace(/'/g,'"').split(",");for(var f=0;f<b.length;f++)e.push(strToJson(b[f]))}else e=c.editor;for(var f=0;f<e.length;f++){var g=e[f].type,h=e[f].id,i=e[f].field;"kindeditor"==g?getTabWindow().$("iframe").each(function(b){this.contentWindow.document.body.innerHTML=html_decode(a[i])}):UE.getEditor(h).ready(function(){UE.getEditor(h).setContent(a[i])})}}})}if("object"==typeof b.parentGrid){var g=getSelectedRowData(b.parentGrid.type,b.parentGrid.id),h=getSelectedRowJson(b.parentGrid.params,g);d.form("load",h)}},onClose:function(){a(c.currentDialogId).form("clear")}};c=a.extend(e,b.dialog);var f=getUrl("controller");c.href=c.href?c.href+location.search:f+"edit"+location.search,a(this).dialog(c)},generateDialogDoc=function(b){var c={iconCls:"icon-add",parentGridUnselectedMsg:"请先选中一条主表数据！",dialog:{title:"数据详情",width:650,height:450}};b=a.extend(c,b);var d=0==b.dialog.form?"div":"form",e="<"+d+' data-toggle="topjui-dialog" data-options="id:\''+b.dialog.id+"',href:'"+b.dialog.href+"',url:'"+b.dialog.url+"',title:'"+b.dialog.title+"',beforeOpenCheckUrl:'"+b.dialog.beforeOpenCheckUrl+"'\"></"+d+">",f="";if("object"==typeof b.dialog.buttonsGroup){var g=b.dialog.buttonsGroup,h=g.length;if(h>0)for(var i=0;i<h;i++)g[i].handler||(g[i].handler="ajaxForm"),f+='<a href="#" data-toggle="topjui-linkbutton" data-options="menubuttonId:\''+b.id+"',handlerBefore:'"+g[i].handlerBefore+"',handler:'"+g[i].handler+"',dialog:{id:'"+b.dialog.id+"'},url:'"+g[i].url+"',iconCls:'"+g[i].iconCls+"'\">"+g[i].text+"</a>"}getTabWindow().$("body").append(e+'<div id="'+b.dialog.id+'-buttons" style="display:none">'+f+'<a href="#" data-toggle="topjui-linkbutton" data-options="iconCls:\'icon-no\'" onclick="javascript:$(\'#'+b.dialog.id+"').dialog('close')\">关闭</a></div>")}}(jQuery),function(a){a.fn.iEdatagrid=function(b){var c={datagridId:this.selector,width:"100%",height:"100%",autoRowHeight:!1,nowrap:!0,fit:!0,fitColumns:!1,border:!1,striped:!0,singleSelect:!0,url:"",toolbar:this.selector+"-toolbar",columns:[[{field:"uuid",title:"UUID",align:"center"},{field:"title",title:"标题",align:"left"},{field:"creator",title:"发布人",align:"center"},{field:"createTime",title:"发布时间",align:"center"}]],multiSort:!1,sortName:"",sortOrder:"",addButton:!0,editButton:!0,deleteButton:!0,searchButton:!0,addDialogTitle:"新增",editDialogTitle:"编辑",rownumbers:!0,pagination:!0,pageNumber:1,pageSize:20,pageList:[10,20,30,40,50,100,200,300,400,500],editable:!0,queryFormId:"",queryAction:"",infoFormId:"",infoAddAction:"",infoUpdateAction:"",infoDlgDivId:"",deleteAction:"",deleteMsg:"",moveDlgDivId:"",moveFormId:"",moveTreeId:"",queryParams:{},queryParamsVCN:{},checkOnSelect:!1,selectOnCheck:!1,kindEditor:[],addDialogId:"#editDialog",editDialogId:"#editDialog",gridParam:"uuid"},b=a.extend(c,b),d=getUrl("controller");b.url=b.url?b.url:d+"getPageSetData",b.getDetailUrl=b.getDetailUrl?b.getDetailUrl:d+"getDetailByUuid",b.addDialogHref=b.addDialogHref?b.addDialogHref:d+"add",b.saveUrl=b.saveUrl?b.saveUrl:d+"save",b.editDialogHref=b.editDialogHref?b.editDialogHref:d+"edit",b.updateUrl=b.updateUrl?b.updateUrl:d+"update",b.destroyUrl=b.destroyUrl?b.destroyUrl:d+"delete",a(this).edatagrid({filterBtnIconCls:"icon-filter",remoteFilter:!0,width:b.width,height:b.height,autoRowHeight:b.autoRowHeight,nowrap:b.nowrap,striped:b.striped,singleSelect:b.singleSelect,url:appendSourceUrlParam(b.url),toolbar:b.toolbar,loadMsg:b.loadMsg,rownumbers:b.rownumbers,pagination:b.pagination,paginPosition:"bottom",pageNumber:b.pageNumber,pageSize:b.pageSize,pageList:b.pageList,frozenColumns:b.frozenColumns,columns:b.columns,multiSort:b.multiSort,sortName:b.sortName,sortOrder:b.sortOrder,fit:b.fit,fitColumns:b.fitColumns,border:b.border,checkOnSelect:b.checkOnSelect,selectOnCheck:b.selectOnCheck,saveUrl:b.saveUrl,updateUrl:b.updateUrl,destroyUrl:b.destroyUrl,onBeforeLoad:function(a){},onLoadSuccess:function(){},onClickRow:function(c,d){if("object"==typeof b.childGrid){var e={};e=getSelectedRowJson(b.childGrid.param,d);for(var f=b.childGrid.grid,g=0;g<f.length;g++)!function(b){setTimeout(function(){var c=a("#"+f[b].id);if("datagrid"==f[b].type){var d=c.datagrid("options").queryParams;c.datagrid("options").queryParams=a.extend({},d,e),c.datagrid("load")}else if("treegrid"==f[b].type){var d=c.treegrid("options").queryParams;c.treegrid("options").queryParams=a.extend({},d,e),c.treegrid("load")}else if("panel"==f[b].type){var g=replaceUrlParamValueByBrace(f[b].href,e);c.panel("refresh",g)}},100*b)}(g)}}})};var b=function(b,c){b.preventDefault();var d=a(this),e=this.headerContextMenu,f="tree-checkbox1",g="tree-checkbox0";if(!e){for(var h=a('<div style="width:150px;"></div>').appendTo("body"),i=d.datagrid("getColumnFields"),j=0;j<i.length;j++){var k=d.datagrid("getColumnOption",i[j]);k.hidden?a('<div iconCls="'+g+'" field="'+i[j]+'"/>').html(k.title).appendTo(h):a('<div iconCls="'+f+'" field="'+i[j]+'"/>').html(k.title).appendTo(h)}e=this.headerContextMenu=h.menu({onClick:function(b){var c=a(b.target).attr("field");b.iconCls==f?(d.datagrid("hideColumn",c),a(this).menu("setIcon",{target:b.target,iconCls:g})):(d.datagrid("showColumn",c),a(this).menu("setIcon",{target:b.target,iconCls:f})),e.menu("show")}})}e.menu("show",{left:b.pageX,top:b.pageY})};a.fn.datagrid.defaults.onHeaderContextMenu=b,a.fn.treegrid.defaults.onHeaderContextMenu=b}(jQuery),$.extend($.fn.datagrid.methods,{fixRownumber:function(a){return a.each(function(){var a=$(this).datagrid("getPanel"),b=$(".datagrid-cell-rownumber",a).last().clone();b.css({position:"absolute",left:-1e3}).appendTo("body");var c=b.width("auto").width();c>25?($(".datagrid-header-rownumber,.datagrid-cell-rownumber",a).width(c+5),$(this).datagrid("resize"),b.remove(),b=null):$(".datagrid-header-rownumber,.datagrid-cell-rownumber",a).removeAttr("style")})},addToolbarItem:function(jq,items){return jq.each(function(){var dpanel=$(this),toolbar=dpanel.children("div.datagrid-toolbar");toolbar.length||(toolbar=$('<div class="datagrid-toolbar"><table cellspacing="0" cellpadding="0"><tr></tr></table></div>').prependTo(dpanel),$(this).datagrid("resize"));for(var tr=toolbar.find("tr"),i=0;i<items.length;i++){var btn=items[i];if("-"==btn)$('<td><div class="datagrid-btn-separator"></div></td>').appendTo(tr);else{var td=$("<td></td>").appendTo(tr),b=$('<a href="javascript:void(0)"></a>').appendTo(td);b[0].onclick=eval(btn.handler||function(){}),b.linkbutton($.extend({},btn,{plain:!0}))}}})},removeToolbarItem:function(a,b){return a.each(function(){var a=$(this).datagrid("getPanel"),c=a.children("div.datagrid-toolbar"),d=null;"number"==typeof b?d=c.find("td").eq(b).find("span.l-btn-text"):"string"==typeof b&&(d=c.find("span.l-btn-text:contains('"+b+"')")),d&&d.length>0&&(d.closest("td").remove(),d=null)})}}),function(a){var b=new Date,c=b.getFullYear(),d=b.getMonth()+1,e=b.getDate(),f=b.getHours();b.getMinutes(),b.getSeconds();a.fn.iTextbox=function(b){var c={width:153,height:30,prompt:"",type:"text",multiline:!1,readonly:!1,disabled:!1,iconCls:"",buttonText:"",buttonIcon:""},b=a.extend(c,b);a(this).textbox(b)},a.fn.iFilebox=function(b){var c={width:450,height:30,prompt:"",type:"text",multiline:!1,readonly:!1,disabled:!1,iconCls:"",buttonText:"选择文件",buttonAlign:"right",required:!1,missingMessage:"必填",onChange:function(){}},b=a.extend(c,b);a(this).filebox(b)},a.fn.iNumberspinner=function(b){var g={width:153,height:30,editable:!0,defaultValueType:"",value:"",min:0,max:999999999,required:!1},b=a.extend(g,b);"currentYear"==b.defaultValueType?(b.value=c,b.min=1900,b.max=2200):"currentSeason"==b.defaultValueType?(1==d||2==d||3==d?b.value=1:4==d||5==d||6==d?b.value=2:7==d||8==d||9==d?b.value=3:10!=d&&11!=d&&12!=d||(b.value=4),b.min=1,b.max=4):"currentMonth"==b.defaultValueType?(b.value=d,b.min=1,b.max=12):"currentDay"==b.defaultValueType?(b.value=e,b.min=1,b.max=31):"currentHour"==b.defaultValueType&&(b.value=f,b.min=0,b.max=24),a(this).numberspinner(b)},a.fn.iDatebox=function(b){var c={required:!1,editable:!0,value:"",width:153,height:30,formatter:function(a){var c=a.getFullYear(),d=a.getMonth()+1,e=a.getDate();return"YYYY"==b.pattern?c:"YYYY-mm"==b.pattern?c+"-"+convertDateToFullDate(d):c+"-"+convertDateToFullDate(d)+"-"+convertDateToFullDate(e)},parser:function(a){var b=Date.parse(a);return isNaN(b)?new Date:new Date(b)},onSelect:function(a){}},b=a.extend(c,b);a(this).datebox(b)},a.fn.iNumberbox=function(b){var c={width:153,height:30,min:0,precision:0,decimalSeparator:".",groupSeparator:",",required:!1,buttonText:""},b=a.extend(c,b);a(this).numberbox(b)},a.fn.iValidatebox=function(b){var c={required:!0,validType:"email"},b=a.extend(c,b);a(this).validatebox(b)},a.fn.iCombobox=function(b){var c={width:153,height:30,url:ctx+"/system/codeItem/getListByCodeSetIdAndLevelId?codeSetId={codeSetId}&levelId={levelId}",codeSetId:0,pid:0,valueField:"text",textField:"text",editable:!1,panelHeight:"auto",onShowPanel:function(){if(b.url.indexOf("{")>=0){var c=a(this).closest("form").serializeObject();a("#"+b.id).combobox("reload",replaceUrlParamValueByBrace(b.url,c))}},onChange:function(c,d){if("object"==typeof b.childCombobox){var e=appendUrlParam(b.childCombobox.url,"parentParam="+c);
a("#"+b.childCombobox.id).combobox("reload",e)}},onSelect:function(c){var d=a(this).closest("form");if(b.params){var e=getSelectedRowJson(b.params,c);getTabWindow().$("#"+d.attr("id")).form("load",e)}}},b=a.extend(c,b);b.data&&(b.url=""),b.codeSetId&&(b.url=b.url.replace("{codeSetId}",b.codeSetId).replace("{levelId}",b.levelId)),a(this).combobox(b)},a.fn.iCombogrid=function(b){var c={width:153,height:30,panelWidth:450,delay:1e3,mode:"remote",url:ctx+"/system/user/getListByKeywords",idField:"userNameId",textField:"userName",fitColumns:!0,columns:[[{field:"userName",title:"姓名"},{field:"userNameId",title:"用户名"},{field:"orgName",title:"所属机构",width:100},{field:"post",title:"职位",width:100}]],onChange:function(c,d){a("#"+b.id).combogrid("grid").datagrid("load",{q:c}),a("#"+b.id).combogrid("grid").datagrid("selectRecord",c)},onLoadSuccess:function(a){},onSelect:function(c,d){if(b.params){var e=a("#"+b.id).closest("form"),f=getSelectedRowJson(b.params,d);getTabWindow().$("#"+e.attr("id")).form("load",f),a("#"+b.id).combogrid("textbox").focus()}}},b=a.extend(c,b);a(this).combogrid(b)},a.fn.iCombotreegrid=function(b){var c={width:153,height:30,panelWidth:450,url:ctx+"/system/user/getListByKeywords",idField:"id",treeField:"text",fitColumns:!0,animate:!0,columns:[[{field:"id",title:"标识",hidden:!0},{field:"text",title:"名称",width:100},{field:"levelId",title:"层级"},{field:"sort",title:"排序"}]],onBeforeExpand:function(c,d){var e=a("#"+b.id).combotreegrid("grid");e.treegrid("options").url=replaceUrlParamValueByBrace(b.expandUrl,c)},onChange:function(a,b){},onLoadSuccess:function(c,d){var e=a("#"+b.id).combotreegrid("grid");e.treegrid("expand",e.treegrid("getRoot").id),b.expandAll&&e.treegrid("expandAll"),b.getFatherIdsUrl&&setTimeout(function(){var c=e.treegrid("getSelected"),d={id:a("#"+b.id).combotreegrid("getValue")};if(null==c&&""!=d.id){var f;a.ajax({type:"POST",url:replaceUrlParamValueByBrace(b.getFatherIdsUrl,d),success:function(a){for(var b=a.split(","),c=b.length-1;c>=0;c--)f=e.treegrid("find",b[c].replace(/'/g,"")),f&&e.treegrid("expand",f.id)}}),void 0!=d.id&&a("#"+b.id).combotreegrid("setValue",d.id)}},100)},onSelect:function(c,d){if(b.param){var e=a("#"+b.id).closest("form"),f=getSelectedRowJson(b.param,d);getTabWindow().$("#"+e.attr("id")).form("load",f),a("#"+b.id).combogrid("textbox").focus()}}},b=a.extend(c,b);a(this).combotreegrid(b)},a.fn.iAutoComplete=function(b){var c={comboboxId:this.selector,url:ctx+"/system/user/getListByUserName?userName=",valueField:"userNameId",textField:"userName",width:450,height:30,panelHeight:250,fieldId:"userNameId",required:!1,formatter:"",onLoadSuccess:function(c,d){setTimeout(function(){a(b.comboboxId).combobox("getValue")},400)},onShowPanel:function(){},onChange:function(c,d){null==c&&(c=a(b.comboboxId).combobox("getValue"));var e=b.url.match(/{([\s\S]*?)}/g),f=b.url;if(e.length>0)for(var g=0;g<e.length;g++)f=f.replace(e[g],encodeURI(encodeURI(c)));a(this).combobox("reload",f)},onSelect:function(c){if(a(b.comboboxId).combobox("hidePanel"),b.params){var d=a("#"+b.id).closest("form"),e=getSelectedRowJson(b.params,c);getTabWindow().$("#"+d.attr("id")).form("load",e)}setTimeout(function(){a(b.comboboxId).combobox("setText",c[b.textField])},1e3)},onUnselect:function(c){setTimeout(function(){a(b.comboboxId).combobox("setValue",""),a(b.comboboxId).combobox("setText","")},400)},onHidePanel:function(){if(b.textField!=b.valueField){var c=a(b.comboboxId).combobox("getText"),d=a(b.comboboxId).combobox("getValue");c==d&&(a(b.comboboxId).combobox("setText",""),a(b.comboboxId).combobox("setValue",""))}}},b=a.extend(c,b);""==b.comboboxId&&(b.comboboxId=a(this).context),a(this).combobox(b)}}(jQuery),$.getUrlParam=function(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)"),c=window.location.search.substr(1).match(b);return null!=c?unescape(c[2]):null},$.getUrlStrParam=function(a,b){var c=a.substring(a.indexOf("?")),d=new RegExp("(^|&)"+b+"=([^&]*)(&|$)"),e=c.substr(1).match(d);return null!=e?unescape(e[2]):null},test=function(a){alert(a)},subString=function(a,b,c){return void 0!=a?a.substring(b,c):""},Array.prototype.indexOf=function(a){for(var b=0;b<this.length;b++)if(this[b]==a)return b;return-1},Array.prototype.remove=function(a){for(var b=this.indexOf(a);b>-1;)this.splice(b,1),b=this.indexOf(a)},function(a){a.fn.iLinkbutton=function(b){var c={iconCls:"icon-edit",plain:!1},b=a.extend(c,b);a(this).linkbutton(b)},a.extend(a.fn.linkbutton.defaults,{onClick:function(){var b=a(this).linkbutton("options");if("ajaxForm"==b.handler||"multiAjaxForm"==b.handler){"undefined"!=b.handlerBefore&&executeCallBackFun(b.handlerBefore);var c={gridId:"datagrid",dialogId:"editDialog"};b=a.extend(c,b);var d=a("#"+b.menubuttonId).linkbutton("options"),e=d.grid,f=d.dialog;if(getTabWindow().$("#"+f.id).form("validate")){if(b.ajaxData=getTabWindow().$("#"+f.id).serialize(),void 0!=b.combotreeFields){var g="";a.each(options.combotreeFields,function(a,c){g+="&"+c.replace(b.postfix,"")+"="+getTabWindow().$("#"+f.id+' input[textboxname="'+c+'"]').combotree("getValues").join(",")+", "}),b.ajaxData+=g}if("multiAjaxForm"==b.handler){var h=getCheckedRowsData(e.type,e.id);if(0==h.length)return void a.messager.alert(topJUI.language.message.title.operationTips,topJUI.language.message.msg.checkSelfGrid,topJUI.language.message.icon.warning);var i=void 0==e.pkName?topJUI.config.pkName:e.pkName;b.ajaxData+="&"+i+"s="+getMultiRowsFieldValue(h,i)}if(getTabWindow().doAjax(b),getTabWindow().$("#"+f.id).dialog("close"),"object"==typeof e)if("datagrid"==e.type)getTabWindow().$("#"+e.id).datagrid("reload");else if("treegrid"==e.type){var j=getSelectedRowData(e.type,e.id);null==j?getTabWindow().$("#"+e.id).treegrid("reload"):getTabWindow().$("#"+e.id).treegrid("reload",j[e.parentIdField])}refreshGrids(b.reload)}else showMessage({statusCode:300,title:topJUI.language.message.title.operationTips,message:"显示红底色的输入框为必填字段",icon:topJUI.language.message.icon.warning})}}})}(jQuery),function(a){a.fn.iMenubutton=function(b){var c={iconCls:"icon-save",hasDownArrow:!1,onClick:function(){a(this).menubutton(b.clickEvent)}},b=a.extend(c,b);a(this).menubutton(b)},a.extend(a.fn.menubutton.methods,{openDialog:function(b,c){var c=a.data(b[0],"menubutton").options,d=c.dialog,e=c.grid,f=c.parentGrid;if(void 0!=d.id){if(!authCheck(d.id))return}else if(!authCheck(d.href))return;if(c.dialog.leftMargin=.5*a(document.body).width()-.5*d.width,c.dialog.topMargin=.5*a(document.body).height()-.5*d.height,"object"==typeof f)openDialogAndloadDataByParentGrid(c);else if(d.url)openDialogAndloadDataByUrl(c);else{if(e.uncheckedMsg){var g=getCheckedRowsData(e.type,e.id);if(0==g.length)return void a.messager.alert(topJUI.language.message.title.operationTips,c.grid.uncheckedMsg,topJUI.language.message.icon.warning)}"undefined"!=d.onBeforeOpen&&executeCallBackFun(d.onBeforeOpen,c),c.href=appendSourceUrlParam(d.href);var h=a("#"+d.id);h.iDialog(c),h.dialog("open")}}})}(jQuery),+function(a){"use strict";a(document).on(topJUI.eventType.initUI.form,function(b){console.log("topJUI.eventType.initUI.form"),a('[data-toggle="topjui-textbox"]').each(function(b){var c=a(this),d=getOptionsJson(c);d.readonly?d.buttonText="只读":d.disabled&&(d.buttonText="禁止"),d=setFormElementId(c,d),c.iTextbox(d)}),a('[data-toggle="topjui-filebox"]').each(function(b){var c=a(this),d=getOptionsJson(c);d=setFormElementId(c,d),c.iFilebox(d)}),a('[data-toggle="topjui-numberspinner"]').each(function(b){var c=a(this),d=getOptionsJson(c);d=setFormElementId(c,d),c.iNumberspinner(d)}),a('[data-toggle="topjui-numberbox"]').each(function(b){var c=a(this),d=getOptionsJson(c);d=setFormElementId(c,d),c.iNumberbox(d)}),a('[data-toggle="topjui-datebox"]').each(function(b){var c=a(this),d=getOptionsJson(c);d=setFormElementId(c,d),c.iDatebox(d)}),a('[data-toggle="topjui-combobox"]').each(function(b){var c=a(this),d=getOptionsJson(c);d=setFormElementId(c,d),c.iCombobox(d)}),a('[data-toggle="topjui-combogrid"]').each(function(b){var c=a(this),d=getOptionsJson(c);d=setFormElementId(c,d),c.iCombogrid(d)}),a('[data-toggle="topjui-combotree"]').each(function(b){var c=a(this),d=getOptionsJson(c);d=setFormElementId(c,d),c.iCombotree(d)}),a('[data-toggle="topjui-combotreegrid"]').each(function(b){var c=a(this),d=getOptionsJson(c);d=setFormElementId(c,d),c.iCombotreegrid(d)}),a('[data-toggle="topjui-textarea"]').each(function(b){var c=a(this),d=getOptionsJson(c);d.multiline=!0,null==d.width&&(d.width=450),null==d.height&&(d.height=66),d=setFormElementId(c,d),c.iTextbox(d)}),a('[data-toggle="topjui-autocomplete"]').each(function(b){var c=a(this),d=getOptionsJson(c);d=setFormElementId(c,d),c.iAutoComplete(d)}),a('[data-toggle="topjui-ueditor"]').each(function(b){var c=a(this),d=getOptionsJson(c);d=setFormElementId(c,d),UE.delEditor(d.id);var e=[["fullscreen","source","|","undo","redo","|","bold","italic","underline","fontborder","strikethrough","superscript","subscript","removeformat","|","formatmatch","autotypeset","blockquote","pasteplain","|","forecolor","backcolor","insertorderedlist","insertunorderedlist","lineheight","|","horizontal","spechars","map","paragraph","fontfamily","fontsize","insertcode","|","indent","justifyleft","justifycenter","justifyright","justifyjustify","|","link","unlink","|","emotion","attachment","simpleupload","insertimage","|","preview"]],f=[["fullscreen","source","undo","redo","bold","italic","underline","fontborder","strikethrough","superscript","subscript","insertunorderedlist","insertorderedlist","justifyleft","justifycenter","justifyright","justifyjustify","removeformat","simpleupload","snapscreen","emotion","attachment","link","unlink","indent","lineheight","autotypeset"]];UE.getEditor(d.id,{toolbars:"simple"==d.mode?f:e,initialFrameWidth:700,autoHeightEnabled:!0,autoFloatEnabled:!0,readonly:!!d.readonly})}),a('[data-toggle="topjui-ueupload"]').each(function(b){var c=a(this),d=getOptionsJson(c);d=setFormElementId(c,d);var e={width:450,buttonText:"选择图片",uploadType:"image",buttonIcon:"icon-picture_add"},d=a.extend(e,d),f=d.id+"Uploader";a("body").append('<script type="text/plain" id="'+f+'"></script>');var g=UE.getEditor(f,{toolbars:[["insertimage","attachment"]]});g.ready(function(){g.setDisabled(),g.hide();var b="afterConfirmUploadedFile",e="url";"image"==d.uploadType&&(b="afterConfirmUploadedImage",e="src"),g.addListener(b,function(b,c){a("#"+d.id).textbox("setText",c[0][e]),a("#"+d.id).textbox("setValue",c[0][e]),"src"==e&&a("#"+d.previewImageId).attr(e,c[0][e])}),d.onClickButton=function(){if("image"==d.uploadType){var a=g.getDialog("insertimage");a.open()}else{var b=g.getDialog("attachment");b.open()}},c.iTextbox(d)})}),a('[data-toggle="topjui-kindeditor"]').each(function(b){var c=a(this),d=getOptionsJson(c);d.items&&(d.items=d.items.replaceAll("'","").replaceAll(" ","").split(",")),d.afterUpload&&(d.afterUpload=d.afterUpload.toFunc()),d.afterSelectFile&&(d.afterSelectFile=d.afterSelectFile.toFunc()),d.confirmSelect&&(d.confirmSelect=d.confirmSelect.toFunc());var e={font:[],span:[".color",".background-color",".font-size",".font-family"],div:[".margin",".padding",".text-align"],table:["align","width"],"td,th":["align","valign","width","height","colspan","rowspan"],a:["href","target","name"],embed:["src","width","height","type","loop","autostart","quality",".width",".height","align","allowscriptaccess"],img:["src","width","height","border","alt","title","align",".width",".height",".border"],"p,ol,ul,li,blockquote,h1,h2,h3,h4,h5,h6":["class","align",".text-align",".color",".font-weight",".font-style",".text-decoration",".vertical-align",".text-indent",".margin-left"],pre:["class"],hr:["class",".page-break-after"],"br,tbody,tr,strong,b,sub,sup,em,i,u,strike,s,del":[]};KindEditor.create(c,{module:d.module?d.module:"未设置",category:d.category?d.category:"default",width:d.width?d.width+"px":"700px",height:d.height?d.height+"px":"600px",pasteType:d.pasteType,minHeight:d.minHeight||150,autoHeightMode:d.autoHeight||!0,afterCreate:function(){},items:"simple"==d.model?["source","fontname","fontsize","|","forecolor","hilitecolor","bold","italic","underline","removeformat","|","justifyleft","justifycenter","justifyright","insertorderedlist","insertunorderedlist","|","emoticons","image","insertfile","link"]:KindEditor.options.items,uploadJson:d.uploadJson||ctx+"/system/attachment/kindeditorUpload",fileManagerJson:d.fileManagerJson||ctx+"/static/kindeditor/4.1.5/jsp/file_manager_json.jsp",allowFileManager:d.allowFileManager||!0,fillDescAfterUploadImage:d.fillDescAfterUploadImage||!0,afterUpload:d.afterUpload,afterSelectFile:d.afterSelectFile,X_afterSelect:d.confirmSelect,htmlTags:e,cssPath:[ctx+"/static/kindeditor/4.1.5/editor-content.css",ctx+"/static/kindeditor/4.1.5/plugins/code/prettify.css"],afterBlur:function(){this.sync()}})}),a('[data-toggle="topjui-upload"]').each(function(b){var c=a(this),d=getOptionsJson(c);setTimeout(function(){var b=d.url,e=b;if(d.url.indexOf("{")!=-1){var f=getSelectedRowData(d.grid.type,d.grid.id);e=replaceUrlParamValueByBrace(b,f)}var g=KindEditor.uploadbutton({button:KindEditor(c)[0],fieldName:"imgFile",url:e||ctx+"/system/attachment/kindeditorUpload?dir=file&module=article&category=default&puuid=11111111111111111111111111111111",afterUpload:function(b){if(0===b.error){console.log(b);var c=KindEditor.formatUrl(b.url,"absolute");a("#"+d.fieldId).textbox("setText",c),a("#"+d.fieldId).textbox("setValue",c),refreshGrid(d.grid.type,d.grid.id)}else alert(b.message)},afterError:function(a){alert("自定义错误信息: "+a)}});g.fileBox.change(function(a){g.submit()})},500)})}),a(document).on(topJUI.eventType.initUI.base,function(b){getTabWindow().$('[data-toggle="topjui-treegrid"]').each(function(b){var c=a(this),d=getOptionsJson(c),e=[];c.find("th").each(function(a){e.push(strToJson("{"+this.getAttribute("data-options")+"}"))}),d.columns=[e],c.attr("id",d.id),getTabWindow().$("#"+d.id).iTreegrid(d)}),getTabWindow().$('[data-toggle="topjui-datagrid"]').each(function(b){var c=a(this),d=getOptionsJson(c),e=c.find("thead:first")[0];if(a(e).attr("frozen")){var e=[];c.find("thead:first th").each(function(a){e.push(strToJson("{"+this.getAttribute("data-options")+"}"))}),d.frozenColumns=[e];var f=[];c.find("thead:eq(1) th").each(function(a){f.push(strToJson("{"+this.getAttribute("data-options")+"}"))})}else{var f=[];c.find("thead th").each(function(a){f.push(strToJson("{"+this.getAttribute("data-options")+"}"))})}d.columns=[f];c.attr("id",d.id),getTabWindow().$("#"+d.id).iDatagrid(d)}),getTabWindow().$('[data-toggle="topjui-edatagrid"]').each(function(b){var c=a(this),d=getOptionsJson(c),e=c.find("thead:first")[0];if(a(e).attr("frozen")){var e=[];c.find("thead:first th").each(function(a){e.push(strToJson("{"+this.getAttribute("data-options")+"}"))}),d.frozenColumns=[e];var f=[];c.find("thead:eq(1) th").each(function(a){f.push(strToJson("{"+this.getAttribute("data-options")+"}"))})}else{var f=[];c.find("thead th").each(function(a){f.push(strToJson("{"+this.getAttribute("data-options")+"}"))})}d.columns=[f];c.attr("id",d.id),getTabWindow().$("#"+d.id).iEdatagrid(d)}),getTabWindow().$('[data-toggle="topjui-tabs"]').each(function(){var b=a(this),c=getOptionsJson(b);b.attr("id",c.id),getTabWindow().$("#"+c.id).iTabs(c)}),getTabWindow().$('[data-toggle="topjui-menubutton"]').each(function(){var b=a(this),c=getOptionsJson(b);c.id=getTimestamp(),a(this).attr("id",c.id),c=bindMenuClickEvent(b,c),a(this).iMenubutton(c)}),getTabWindow().$('[data-toggle="topjui-uploader"]').each(function(){var b=a(this),c=getOptionsJson(b);a(this).iMenubutton(c);var d,e,f,g="pending",h=0,i=!1,j='<div id="uploaderDialog"><div id="upfileGrid-toolbar" data-options="border:false"><div style="float: left;margin-right:5px;"><div id="chooseFile">选择文件</div></div><a id="addUpFile" style="margin-right:5px;">开始上传</a><a id="removeUpFile">移除文件</a></div><table id="upfileGrid"></table></div>';getTabWindow().$("body").append(j+'<div id="uploaderDialog-buttons" style="display:none"><a href="#" id="closeUploaderDialog">关闭</a></div>'),e=a("#upfileGrid").datagrid({fit:!0,fitColumns:!0,rownumbers:!0,nowrap:!0,animate:!1,border:!1,singleSelect:!1,idField:"fileId",pagination:!1,toolbar:"#upfileGrid-toolbar",columns:[[{field:"ck",checkbox:!0},{field:"fileId",title:"fileId",hidden:!0},{field:"fileName",title:"文件名称",width:100},{field:"fileSize",title:"文件大小",width:30},{field:"validateMd5",title:"文件验证",width:20},{field:"progress",title:"上传进度",width:180,fixed:!0,formatter:function(a,b){var c='<div class="easyui-progressbar progressbar" style="width: 170px; height: 20px;" value="'+a+'" text="'+a+'%"><div class="progressbar-text" style="width: 170px; height: 20px; line-height: 20px;">'+a+'%</div><div class="progressbar-value" style="width: '+a+'%; height: 20px; line-height: 20px;"><div class="progressbar-text" style="width: 170px; height: 20px; line-height: 20px;">'+a+"%</div></div></div>";return c}},{field:"fileState",title:"上传状态",width:20}]]}),WebUploader.Uploader.register({"before-send-file":"beforeSendFile"},{beforeSendFile:function(b){var c=new a.Deferred;return(new WebUploader.Uploader).md5File(b,0,10485760).progress(function(a){e.datagrid("updateRow",{index:e.datagrid("getRowIndex",b.id),row:{validateMd5:100*a+"%"}})}).then(function(f){a.ajax({type:"POST",url:"/system/attachment/md5Validate",data:{type:"md5Check",md5:f},cache:!1,timeout:3e3,dataType:"json"}).then(function(g,h,i){g.isHave?(c.reject(),d.skipFile(b),e.datagrid("updateRow",{index:e.datagrid("getRowIndex",b.id),row:{fileState:"秒传",progress:100}})):(a.extend(d.options.formData,{md5:f}),c.resolve())},function(a,b,d){c.resolve()})}),a.when(c)}}),d=WebUploader.create({resize:!1,swf:"/static/webuploader/js/Uploader.swf",server:"/system/attachment/upload",pick:"#chooseFile",fileSingleSizeLimit:104857600,accept:[{title:"file",extensions:"doc,docx,pdf,xls,xlsx,ppt,pptx,gif,jpg,jpeg,bmp,png,rar,zip",mimeTypes:".doc,.docx,.pdf,.xls,.xlsx,.ppt,.pptx,.gif,.jpg,.jpeg,.bmp,.png,.rar,.zip"}]}),d.on("fileQueued",function(a){var b=bytesToSize(a.size),c={fileId:a.id,fileName:a.name,fileSize:b,validateMd5:"0%",progress:0,fileState:"等待上传"};e.datagrid("insertRow",{index:0,row:c})}),d.on("uploadProgress",function(a,b){e.datagrid("updateRow",{index:e.datagrid("getRowIndex",a.id),row:{progress:(100*b).toFixed(2)}})}),d.on("uploadSuccess",function(b){for(var c=e.datagrid("getRows"),d=0;d<c.length;d++)c[d].fileId==b.id&&(a("input[type='checkbox']")[d+1].disabled=!0);a("#removeUpFile").linkbutton("disable"),e.datagrid("updateRow",{index:e.datagrid("getRowIndex",b.id),row:{fileState:"上传成功"}}),i=!0}),d.on("uploadError",function(a){e.datagrid("updateRow",{index:e.datagrid("getRowIndex",a.id),row:{fileState:"上传失败"}})}),d.on("uploadComplete",function(a){}),d.on("uploadFinished",function(){a("#attachmentDg").datagrid("reload")}),d.on("error",function(a){"F_EXCEED_SIZE"==a?tim.parentAlert("error","上传的单个文件不能大于"+h+"。<br>操作无法进行,如有需求请联系管理员","error"):"Q_TYPE_DENIED"==a&&tim.parentAlert("error","不允许上传此类文件!。<br>操作无法进行,如有需求请联系管理员","error")});var k=function(){for(var a=e.datagrid("getSelections"),b=[],c=0;c<a.length;c++)b.push(a[c]);for(var f=0;f<b.length;f++){var g=e.datagrid("getRowIndex",b[f]);d.removeFile(b[f].fileId,!0),e.datagrid("deleteRow",g)}e.datagrid("clearSelections")},l=function(b,c){return b.getFiles().length<=0?void a.messager.alert("提示","没有上传的文件!","error"):void("uploading"===g?b.stop():(b.option("formData",{puuid:c.uuid}),b.upload()))};b.on("click",function(){if("object"==typeof c.parentGrid&&(f=getSelectedRowData(c.parentGrid.type,c.parentGrid.id),!f))return void a.messager.alert(topJUI.language.message.title.operationTips,c.parentGrid.unselectedMsg||topJUI.language.message.msg.selectParentGrid,topJUI.language.message.icon.warning);var b=e.datagrid("getRows");b.length>0&&(e.datagrid("selectAll"),k());var g=a("#uploaderDialog"),h={iconCls:"icon-add",parentGridUnselectedMsg:"请先选中一条主表数据！",dialog:{title:"附件上传",width:900,height:500,maximized:!1,maximizable:!0,buttons:"#uploaderDialog-buttons"}};c=a.extend(h,c),g.dialog({title:c.dialog.title,width:c.dialog.width,height:c.dialog.height,maximized:c.dialog.maximized,maximizable:c.dialog.maximizable,buttons:c.dialog.buttons}),g.dialog("open"),a("#addUpFile").linkbutton({iconCls:"icon-add",height:37,onClick:function(){l(d,f)}}),a("#removeUpFile").linkbutton({iconCls:"icon-no",height:37,onClick:k}),a("#closeUploaderDialog").linkbutton({iconCls:"icon-no",onClick:function(){g.dialog("close")}})})}),getTabWindow().$('[data-toggle="topjui-submenubutton"]').each(function(){var b=a(this),c=getOptionsJson(b);bindMenuClickEvent(b,c)}),getTabWindow().$('[data-toggle="topjui-dialog"]').each(function(){var b=a(this),c=getOptionsJson(b),d=b.attr("href");void 0!=d?(c.href=d,getTabWindow().$("body").append('<div id="'+c.id+'"></div>'),getTabWindow().$("#"+c.id).iDialog(c),b.on("click",function(){return getTabWindow().$("#"+c.id).dialog("open"),!1})):b.attr("id",c.id)}),getTabWindow().$('[data-toggle="topjui-linkbutton"]').each(function(b){var c=a(this),d=getOptionsJson(c);c.iLinkbutton(d)})}),a(document).on(topJUI.eventType.initUI.base2,function(b){getTabWindow().$('[data-toggle="topjui-menu"]').each(function(b){var c=a(this),d=getOptionsJson(c);c.attr("id",d.id),getTabWindow().$("#"+d.id).iMenu(d)}),getTabWindow().$('[data-toggle="topjui-tree"]').each(function(b){var c=a(this),d=getOptionsJson(c);c.attr("id",d.id),getTabWindow().$("#"+d.id).iTree(d)})}),a(document).on(topJUI.eventType.initUI.echarts,function(b){getTabWindow().$('[data-toggle="topjui-echarts"]').length>0&&getTabWindow().$('[data-toggle="topjui-echarts"]').each(function(b){var c=a(this),d=getOptionsJson(c),e=getTabWindow().document.getElementById(c[0].id),f=echarts.init(e);f.setOption({title:{text:""},tooltip:{},legend:{data:[]},series:[]}),a.ajax({url:d.url,type:"post",dataType:"json",success:function(a,b,c){"bar"!=d.type&&"line"!=d.type||f.setOption({title:{text:a.title},xAxis:{data:a.categories},yAxis:{},legend:{data:a.legend},series:a.series}),"pie"==d.type&&f.setOption({title:{text:a.title,x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:a.legend,series:a.series}),"gauge"==d.type&&f.setOption({tooltip:{formatter:"{a} <br/>{b} : {c}%"},series:[{name:"业务指标",type:"gauge",detail:{formatter:"{value}%"},data:[{value:17.1,name:"党员发展率"}]}]})},error:function(a){alert("获取图表数据失败!"),f.hideLoading()}})})}),a(document).on(topJUI.eventType.initUI.advanceSearchForm,function(b){for(var c=a.cookie("fieldNameStr").split(","),d=a.cookie("colNameStr").split(","),e=[],f=0;f<d.length;f++)e.push({value:c[f],text:d[f]});a(".field:last").combobox({textField:"text",valueField:"value",data:e,editable:!1,width:140}),a(".op:last").combobox({textField:"text",valueField:"value",data:[{text:"包含",value:"contains",selected:!0},{text:"等于",value:"equal"},{text:"不等于",value:"notequal"},{text:"大于",value:"greater"},{text:"大于或等于",value:"greaterorequal"},{text:"小于",value:"less"},{text:"小于或等于",value:"lessorequal"},{text:"以...开头",value:"beginwith"},{text:"以...结尾",value:"endwith"}],width:120,panelHeight:220,editable:!1}),a(".value:last").textbox({}),a(".join:last").combobox({textField:"text",valueField:"value",data:[{text:"并且",value:"and",selected:!0},{text:"或者",value:"or"}],width:70,panelHeight:50,editable:!1}),a("#addCondition").menubutton({iconCls:"icon-add",hasDownArrow:!1}),a(".deleteCondition:last").menubutton({iconCls:"icon-delete",hasDownArrow:!1}),a(".deleteCondition:last").on("click",function(){var b=a(".deleteCondition").index(this)+1;getTabWindow().$("#advanceSearchTable tr:eq("+b+")").remove()})}),a(document).on(topJUI.eventType.initUI.importExcelForm,function(b){setTimeout(function(){for(var b=a.cookie("fieldNameStr"),c=b.split(","),d="",e=0;e<c.length;e++)d+=e==c.length-1?"'{"+e+"}'":"'{"+e+"}',";var f="INSERT INTO {table} ("+b+") VALUES ("+d+")";a("#importExcelSql").textbox("setValue",f)},1e3)})}(jQuery),$(function(){function a(a){"datagrid"==$.cookie("gridType")?$("#"+$.cookie("gridId")).datagrid("load",{advanceFilter:JSON.stringify(a)}):"treegrid"==$.cookie("gridType")&&$("#"+$.cookie("gridId")).treegrid("load",{advanceFilter:JSON.stringify(a)})}var b=getUrl();b!=topJUI.config.mainPagePath&&($(this).trigger(topJUI.eventType.initUI.base),$(this).trigger(topJUI.eventType.initUI.base2)),"y"!=$.cookie("verify")&&navigator.onLine&&$.ajax({type:"GET",url:$.base64.decode("aHR0cDovL2xpY2Vuc2UuZXdzZC5jbi90b3BqdWkvY2xpZW50L3ZlcmlmeQ=="),data:"host="+window.location.host+"&href="+window.location.href,dataType:"jsonp",jsonp:"callback",processData:!1,success:function(a){if("1"==a.status){var b=new Date;b.setTime(b.getTime()+60*a.intervalMinute*1e3),$.cookie("verify","y",{expires:b,path:"/"}),$.messager.alert(decodeURI($.base64.decode("JUU4JUFEJUE2JUU1JTkxJThB")),decodeURI($.base64.decode("JUU4JUFGJUE1JUU3JUIzJUJCJUU3JUJCJTlGJUU2JTg5JTgwJUU0JUJEJUJGJUU3JTk0JUE4JUU3JTlBJTg0VG9wSlVJJUU1JTg5JThEJUU3JUFCJUFGJUU2JUExJTg2JUU2JTlFJUI2JUU2JTlDJUFBJUU4JUEyJUFCJUU2JThFJTg4JUU2JTlEJTgzJUU0JUJEJUJGJUU3JTk0JUE4JUVGJUJDJThDJUU3JUIzJUJCJUU3JUJCJTlGJUU1JUFEJTk4JUU1JTlDJUE4JUU5JUEzJThFJUU5JTk5JUE5JUVGJUJDJTgxJUU4JUFGJUI3JUU0JUI4JThFJUU3JUIzJUJCJUU3JUJCJTlGJUU2JThGJTkwJUU0JUJFJTlCJUU4JTgwJTg1JUU4JTgxJTk0JUU3JUIzJUJCJUU2JTg4JTk2JUU0JUJCJThFJTNDYSUyMGhyZWY9JTIyaHR0cDovL3d3dy5ld3NkLmNuJTIyJTIwdGFyZ2V0PSUyMl9ibGFuayUyMiUyMHN0eWxlPSUyMmNvbG9yOnJlZDslMjIlM0UlRTUlQUUlOTglRTYlOTYlQjklRTclQkQlOTElRTclQUIlOTklM0MvYSUzRSVFOCU4RSVCNyVFNSVCRSU5NyVFNCVCRCVCRiVFNyU5NCVBOCVFNiU4RSU4OCVFNiU5RCU4MyVFRiVCQyU4MQ==")))}}}),$("#advanceSearchDialog").dialog({width:620,height:200,title:"高级查询",modal:!1,collapsible:!0,minimizable:!1,maximized:!1,resizable:!0,closed:!0,iconCls:"icon-find",href:"/system/search/advanceSearch",zIndex:10,buttons:"#advanceSearchDialog-buttons",onLoad:function(){$(this).trigger(topJUI.eventType.initUI.advanceSearchForm)}}),$("#resetAdvanceSearchForm").on("click",function(){var b=[];a(b)}),$("#submitAdvanceSearchForm").on("click",function(){for(var b=[],c=$("#advanceSearchDialog").serializeArray(),d=c.length/4,e=0;e<d;e++){var f=(c[4*e].name,c[4*e].value),g=(c[4*e+1].name,c[4*e+1].value),h=(c[4*e+2].name,c[4*e+2].value),i=(c[4*e+3].name,c[4*e+3].value);b.push({field:f,op:g,value:h,join:i})}a(b)}),setTimeout(function(){$("#importExcelDialog").dialog({width:650,height:200,title:"高级查询",modal:!1,collapsible:!0,minimizable:!1,maximized:!1,resizable:!0,closed:!0,iconCls:"icon-find",href:"/system/excel/excelImport",zIndex:10,buttons:"#importExcelDialog-buttons",onLoad:function(){$(this).trigger(topJUI.eventType.initUI.importExcelForm)}})},1e3),$("#submitImportExcelForm").on("click",function(){var a=$("#importExcelDialog").serializeArray();$.ajax({type:"POST",url:getUrl("controller")+"importExcel",data:a,dataType:"json",success:function(a){showMessage({statusCode:a.statusCode,title:a.title,message:a.message}),$("#importExcelDialog").dialog("close").form("reset"),refreshGrid($.cookie("gridType"),$.cookie("gridId"))},error:function(a){showMessage({statusCode:300,title:"操作提示",message:a})}})})}),function(a){a.fn.iTabs=function(b){var c=!0,d={title:"",closable:!0,iconCls:"",content:"",border:!1,fit:!0,onSelect:function(d,e){var f=b.tabs,g=a("#"+b.id).tabs("getTab",e),h=g.panel("options");if(void 0!=h.href){var i='<iframe src="'+h.href+'" scrolling="auto" frameborder="0" style="width:100%;height:100%;"></iframe>';g.panel({content:i}),g.panel("refresh")}else{if(!c){var j={};if("datagrid"==f[e].type){var k=g.datagrid("options"),l=a("#"+k.parentGrid.id);if("datagrid"==k.parentGrid.type)var m=l.datagrid("getSelected");if("treegrid"==k.parentGrid.type)var m=l.treegrid("getSelected");if(m){j=getSelectedRowJson(k.parentGrid.param,m);var n=g.datagrid("options").queryParams;g.datagrid("options").queryParams=a.extend({},n,j),g.datagrid("load")}else g.datagrid("load")}else if("treegrid"==f[e].type){var k=g.panel("options"),l=a("#"+k.parentGrid.id);if("datagrid"==k.parentGrid.type)var m=l.datagrid("getSelected");if("treegrid"==k.parentGrid.type)var m=l.treegrid("getSelected");if(m){j=getSelectedRowJson(k.parentGrid.param,m);var n=g.datagrid("options").queryParams;g.treegrid("options").queryParams=a.extend({},n,j),g.treegrid("load")}else g.treegrid("load")}else if("panel"==f[e].type){var h=g.panel("options"),l=a("#"+h.parentGrid.id);if("datagrid"==h.parentGrid.type)var m=l.datagrid("getSelected");if("treegrid"==h.parentGrid.type)var m=l.treegrid("getSelected");if(m){var o=replaceUrlParamValueByBrace(h.dynamicHref,m),i='<iframe src="'+o+'" scrolling="auto" frameborder="0" style="width:100%;height:100%;"></iframe>';g.panel({content:i})}else g.panel("refresh")}}c=!1}},onLoad:function(a){}},b=a.extend(d,b);a(this).tabs(b)},a.extend(a.fn.tabs.methods,{myAdd:function(b,c){return b.each(function(){a(this).tabs("add",c)})},bindDblclick:function(b,c){return b.each(function(){var b=this;a(this).children("div.tabs-header").find("ul.tabs").undelegate("li","dblclick.tabs").delegate("li","dblclick.tabs",function(d){if(c&&"function"==typeof c){var e=a(this).text(),f=a(b).tabs("getTabIndex",a(b).tabs("getTab",e));c(f,e)}})})},unbindDblclick:function(b){return b.each(function(){a(this).children("div.tabs-header").find("ul.tabs").undelegate("li","dblclick.tabs")})}})}(jQuery),$(function(){}),function(a){a.fn.iTree=function(b){var c={treeId:this.selector,url:ctx+"/system/codeItem/getListByCodeSetIdAndLevelId?codeSetId={codeSetId}&levelId={levelId}",expandUrl:ctx+"/system/codeItem/getListByPid?pid={pid}",lines:!1,animate:!0,border:!1,clickEvent:"clickEventName",queryParams:{},onContextMenu:"",refreshDatagridId:"#datagrid"},b=a.extend(c,b);b.url.indexOf("codeSetId")==-1?b.url=b.url+"?codeSetId="+b.codeSetId+"&levelId="+b.levelId:b.url=b.url.replace("{codeSetId}",b.codeSetId).replace("{levelId}",b.levelId),""==b.treeId&&(b.treeId=a(this).context),a(this).tree({url:b.url,lines:b.lines,animate:b.animate,border:b.border,onContextMenu:b.onContextMenu,onBeforeExpand:function(c,d){a(b.treeId).tree("options").url=b.expandUrl.replace("{pid}",c.id)},onClick:function(c){if("postCodeItemIdAndRefreshDatagrid"==b.clickEvent){var d=a(b.refreshDatagridId),e=d.datagrid("options").queryParams,f=b.queryParams;f.codeSetId=c.codesetid,f.codeItemId=c.id,f.pid=c.pid,f.code=c.code,d.datagrid("options").queryParams=a.extend({},e,f),d.datagrid("reload")}else if("postTreeParamsAndRefreshDatagrid"==b.clickEvent){var d=a(b.refreshDatagridId),e=d.datagrid("options").queryParams;f=b.queryParams,f.codeSetId=c.codesetid,f.codeItemId=c.id,f.id=c.id,f.pid=c.pid,f.text=c.text,f.code=c.code,d.datagrid("options").queryParams=a.extend({},e,f),d.datagrid("reload")}else"closed"==c.state?a(b.treeId).tree("expand",c.target):a(b.treeId).tree("collapse",c.target)},onLoadSuccess:function(){setTimeout(function(){var c=a(b.treeId).tree("getRoot");a(b.treeId).tree("expand",c.target)},1e3)}})}}(jQuery),function(a){a.fn.iTreegrid=function(b){var c={gridId:this.selector,treegridContextId:"treegridContext",url:ctx+"/system/codeItem/getListByCodeSetIdAndLevelId",queryParams:{codeSetId:a.getUrlParam("codeSetId"),levelId:a.getUrlParam("levelId")},onBeforeExpandUrl:ctx+"/system/codeItem/getListByPid",idField:"id",treeField:"text",fit:!0,fitColumns:!0,border:!1,toolbar:this.selector+"-toolbar",pagination:!1,pageNumber:1,pageSize:20,pageList:[10,20,30,40,50],animate:!0,columns:[[{field:"text",title:"名称"},{field:"codeSetId",title:"体系代码",width:100},{field:"id",title:"编号"},{field:"pid",title:"父级编号"},{field:"levelId",title:"层级",width:100},{field:"sort",title:"排序",width:100},{field:"code",title:"代码",width:100},{field:"status",title:"状态",width:100}]],checkOnSelect:!1,selectOnCheck:!1,onBeforeExpand:function(c){a(this).treegrid("options").url=replaceUrlParamValueByBrace(b.expandUrl,c)},onLoadSuccess:function(){var c=a(b.gridId).treegrid("getRoot");c&&a(b.gridId).treegrid("expand",c.id),a(this).treegrid("options").url=appendSourceUrlParam(b.url)},onContextMenu:function(a,b){},onClickRow:function(c){if(a("#"+b.id).treegrid("cascadeCheck",{id:c.id,deepCascade:!0}),"object"==typeof b.childGrid){var d={};d=getSelectedRowJson(b.childGrid.params,c);for(var e=b.childGrid.grids,f=0;f<e.length;f++){
var g=a("#"+e[f].id);if("datagrid"==e[f].type){var h=g.datagrid("options").queryParams;g.datagrid("options").queryParams=a.extend({},h,d),g.datagrid("load")}else if("treegrid"==e[f].type){var h=g.treegrid("options").queryParams;g.treegrid("options").queryParams=a.extend({},h,d),g.treegrid("load")}else if("panel"==e[f].type){var i=replaceUrlParamValueByBrace(e[f].href,c);g.panel("refresh",i)}}}if("object"==typeof b.childTab)for(var j=b.childTab.tabs,f=0;f<j.length;f++){var k=a("#"+j[f].id),l=k.tabs("options"),m=k.tabs("getTabIndex",k.tabs("getSelected")),n=l.tabs,o=a("#"+n[m].id),d={};if(d=getSelectedRowJson(j[f].params,c),"datagrid"==n[m].type){var h=o.datagrid("options").queryParams;o.datagrid("options").queryParams=a.extend({},h,d),o.datagrid("load")}else if("treegrid"==n[m].type){var h=o.treegrid("options").queryParams;o.treegrid("options").queryParams=a.extend({},h,d),o.treegrid("load")}else if("panel"==n[m].type){var p=o.panel("options"),q=replaceUrlParamValueByBrace(p.dynamicHref,c),r='<iframe src="'+q+'" scrolling="auto" frameborder="0" style="width:100%;height:100%;"></iframe>';o.panel({content:r})}}}},b=a.extend(c,b);b.url=appendSourceUrlParam(b.url),a(this).treegrid(b)},a.extend(a.fn.treegrid.methods,{cascadeCheck:function(b,c){function d(b,c,e,f){var g=a(b.selector).treegrid("getParent",c);if(g){var h=g[e];f?a(b.selector).treegrid("select",h):a(b.selector).treegrid("unselect",h),d(b,h,e,f)}}function e(b,c,d,f,g){!g&&f&&a(b).treegrid("expand",c);for(var h=a(b).treegrid("getChildren",c),i=0;i<h.length;i++){var j=h[i][d];g?a(b).treegrid("select",j):a(b).treegrid("unselect",j),e(b,j,d,f,g)}}var f=a.data(b[0],"treegrid").options;if(!f.singleSelect){for(var g=f.idField,h=!1,i=a(b.selector).treegrid("getSelections"),j=0;j<i.length;j++)i[j][g]==c.id&&(h=!0);d(b,c.id,g,h),e(b,c.id,g,c.deepCascade,h)}}})}(jQuery),function(a){a.fn.myWindow=function(b){function c(b,c){var d=a('<div region="center" border="false" style="padding:5px;"></div>').html(b);a('<div class="easyui-layout" fit="true"></div>').append(d).append('<div region="south" border="false" style="padding-top:5px;height:40px; overflow:hidden; text-align:center;background:#fafafa;border-top:#eee 1px solid;">  <a iconCls="icon-ok">确定</a><a iconCls="icon-cancel">取消</a></div>').appendTo(a("#w").empty()).layout(),a(".easyui-layout a[iconCls]").linkbutton(),a('a[iconCls="icon-cancel"]').click(function(){a("#w").window("close")}),a('a[iconCls="icon-ok"]').unbind("click").click(c)}var d={width:500,height:400,iconCls:"",collapsible:!1,minimizable:!1,maximizable:!1,resizable:!1,title:"窗口标题",modal:!0,submit:function(){alert("写入执行的代码。")},html:""},b=a.extend(d,b),e=b.html;a("#w").window({title:b.title,width:b.width,height:b.height,content:c(e,b.submit),collapsible:b.collapsible,minimizable:b.minimizable,maximizable:b.maximizable,modal:b.modal,iconCls:b.iconCls}).window("open")}}(jQuery),jQuery.base64=function(a){function b(a,b){var c=g.indexOf(a.charAt(b));if(c===-1)throw"Cannot decode base64";return c}function c(a){var c,d,e=0,g=a.length,h=[];if(a=String(a),0===g)return a;if(g%4!==0)throw"Cannot decode base64";for(a.charAt(g-1)===f&&(e=1,a.charAt(g-2)===f&&(e=2),g-=4),c=0;c<g;c+=4)d=b(a,c)<<18|b(a,c+1)<<12|b(a,c+2)<<6|b(a,c+3),h.push(String.fromCharCode(d>>16,d>>8&255,255&d));switch(e){case 1:d=b(a,c)<<18|b(a,c+1)<<12|b(a,c+2)<<6,h.push(String.fromCharCode(d>>16,d>>8&255));break;case 2:d=b(a,c)<<18|b(a,c+1)<<12,h.push(String.fromCharCode(d>>16))}return h.join("")}function d(a,b){var c=a.charCodeAt(b);if(c>255)throw"INVALID_CHARACTER_ERR: DOM Exception 5";return c}function e(a){if(1!==arguments.length)throw"SyntaxError: exactly one argument required";a=String(a);var b,c,e=[],h=a.length-a.length%3;if(0===a.length)return a;for(b=0;b<h;b+=3)c=d(a,b)<<16|d(a,b+1)<<8|d(a,b+2),e.push(g.charAt(c>>18)),e.push(g.charAt(c>>12&63)),e.push(g.charAt(c>>6&63)),e.push(g.charAt(63&c));switch(a.length-h){case 1:c=d(a,b)<<16,e.push(g.charAt(c>>18)+g.charAt(c>>12&63)+f+f);break;case 2:c=d(a,b)<<16|d(a,b+1)<<8,e.push(g.charAt(c>>18)+g.charAt(c>>12&63)+g.charAt(c>>6&63)+f)}return e.join("")}var f="=",g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h="1.0";return{decode:c,encode:e,VERSION:h}}(jQuery);